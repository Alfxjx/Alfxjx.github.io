<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="/style/index.css"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&amp;display=swap"/><script async="" defer="" data-website-id="3890bdd6-8ff5-4da5-8b72-45ba24876897" src="https://umami-alfxjx.up.railway.app/umami.js"></script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2649b9740f492fab27ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2649b9740f492fab27ec.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8fa755d3830e88407993.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8fa755d3830e88407993.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-6c6eb080c4d41d8fd79b.js" defer=""></script><script src="/_next/static/chunks/main-4fc50673e5500481d568.js" defer=""></script><script src="/_next/static/chunks/pages/_app-075949e5fa5ffddc911e.js" defer=""></script><script src="/_next/static/chunks/252f366e-b63e9f131b12ce609c69.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-b8804bb07d4f86914404.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-eb29eaaad2b07bc95110.js" defer=""></script><script src="/_next/static/chunks/1a48c3c1-63272919e4bbaae4097e.js" defer=""></script><script src="/_next/static/chunks/608-bb5bf9a1b1d10ad22ac0.js" defer=""></script><script src="/_next/static/chunks/553-f50d93340fc41d40714e.js" defer=""></script><script src="/_next/static/chunks/307-d4f637d0181fb2085729.js" defer=""></script><script src="/_next/static/chunks/pages/tech/%5Bslug%5D-6a6947d46afa43b14f3e.js" defer=""></script><script src="/_next/static/Q5-ARss9H4OnstBP8NDja/_buildManifest.js" defer=""></script><script src="/_next/static/Q5-ARss9H4OnstBP8NDja/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap">@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrFJM.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9V1g.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJbecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJnecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJfecnFHGPc.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z11lFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z1JlFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z1xlFd2JQEk.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Post__Wrapper-sc-q8sq7-0 dzXARM"><div class="ProgressBar__FixedTopWrapper-sc-1ufpd9c-0 ProgressBar__ProgressBarWrapperFixed-sc-1ufpd9c-1 lmAxqe ketkUq"><div class="bar-used"></div></div><div class="header"><div class="icon-wrapper"><div class="icons"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg></div><div class="icons"><a href="/tech"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m7.375 16.781 1.25-1.562L4.601 12l4.024-3.219-1.25-1.562-5 4a1 1 0 0 0 0 1.562l5 4zm9.25-9.562-1.25 1.562L19.399 12l-4.024 3.219 1.25 1.562 5-4a1 1 0 0 0 0-1.562l-5-4zm-1.649-4.003-4 18-1.953-.434 4-18z"></path></svg></a></div></div></div><div class="toggle"><button class="switch__SwitchWrapper-sc-19ps08m-0 eMIOez"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path></svg><div class="round"></div></button></div><div style="height:3.25rem"></div><div class="Post-sc-1u8x57o-0 Post__PostWrapper-sc-q8sq7-1 hcSpXI fqyuhB"><div class="info"><h1>如何设计一个好用的组件-以chakra-ui为例</h1><div class="user"><img class="img" src="/assets/authors/alfxjx.jpg" alt="Alfxjx"/><span class="title">Alfxjx</span><div class="date">2021-10-28</div></div></div><div class="post"><blockquote>
<p>同时发布于 <a href="https://www.yuque.com/alfxjx/notes/wchz9f">语雀</a></p>
</blockquote>
<h2>引子</h2>
<p>最近公司在搭建部门的统一平台，我负责了统一登录前端的开发，因为要对接很多的系统，所以开发了统一登录的sdk，说是sdk其实就是一个组件库。以此为契机，外加之前开发其他的系统中也用了很多种不同的组件库（饿了没-ui/vant/antd/chakra-ui...），今天写一篇文章说说，什么样的组件设计是比较合理的，以及如何设计一个好用的组件。</p>
<h2>研究chakra-ui</h2>
<p><img src="/assets/blog/chakra-ui.png" alt=""></p>
<p>比较来说我觉得设计比较有特色的一个组件库，就是 <a href="https://chakra-ui.com/">chakra-ui</a> 了，不过国内使用的并不多，我也是在之前技术选型的时候偶然找到的，但是仔细读了她的文档之后我发现这个是一个很有特色的组件库，下面细说：</p>
<h3>样式自定义</h3>
<p>找到这个 chakra-ui 的时候，就是因为需要在使用 tailwind CSS 的同时使用一个组件库，chakra-ui 的一个特色就是使用了和 tailwind CSS 几乎相同的样式 api , 例如：</p>
<pre><code>import { Box } from "@chakra-ui/react"

// m={2} refers to the value of `theme.space[2]`
&#x3C;Box m={2}>Tomato&#x3C;/Box>

// You can also use custom values
&#x3C;Box maxW="960px" mx="auto" />

// sets margin `8px` on all viewports and `16px` from the first breakpoint and up
&#x3C;Box m={[2, 3]} />
</code></pre>
<p>这样只要你记住了 tailwind CSS 的api， 那么就可以很快的上手 chakra-ui 。
那么这个是怎么实现的呢？
一开始我以为是组件库使用了tailwind CSS ，但是看了源码发现，chakra 将 styled-components 进行了二次封装，而这种 tailwindLike 的 api 是进行了模拟导致的。
在 <a href="https://github.com/chakra-ui/chakra-ui/blob/main/packages/styled-system/src/config/background.ts">/packages/styled-system/config/</a> 里面 写入了不同样式以及缩写，以 background 为例：</p>
<pre><code>export const background: Config = {
  background: t.colors("background"),
  ...
  bg: t.colors("background"),
  ...
}
</code></pre>
<p>这样实现的，可以说把dirty的工作封装了起来，展示出来的结果都是好用的。</p>
<h3>组件组合</h3>
<p>书接上文，组件里面做了很多的映射封装，为了减少代码量，统一进行管理，组件库进行了组件的组合（compose）。从一个基本的组件出发，通过默认一些样式，创造了一些新的组件。
例如<a href="https://chakra-ui.com/docs/layout/center#square-and-circle"> Square Circle </a>组件，是基于 Box 组件extend而来的。</p>
<pre><code>export const Square = forwardRef&#x3C;SquareProps, "div">((props, ref) => {
  const { size, centerContent = true, ...rest } = props

  const styles: SystemStyleObject = centerContent
    ? { display: "flex", alignItems: "center", justifyContent: "center" }
    : {}

  return (
    &#x3C;Box
      ref={ref}
      boxSize={size}
      __css={{
        ...styles,
        flexShrink: 0,
        flexGrow: 0,
      }}
      {...rest}
    />
  )
})

if (__DEV__) {
  Square.displayName = "Square"
}

export const Circle = forwardRef&#x3C;SquareProps, "div">((props, ref) => {
  const { size, ...rest } = props
  return &#x3C;Square size={size} ref={ref} borderRadius="9999px" {...rest} />
})

if (__DEV__) {
  Circle.displayName = "Circle"
}
</code></pre>
<p>这样写减少了重复的代码并且可以保持更好的可维护性。我们在开发的过程中也可以借鉴这种模式，开发出最抽象的组件，从这个最抽象的父类出发来进行派生。</p>
<h3>Theminig</h3>
<p>chakra ui 的另外一个特点就是拥有一个高度自定义的主题系统， 使用的方式类似于 tailwind CSS <a href="https://tailwindcss.com/docs/theme">设置</a>，也就是说你可同时将一个theme文件应用到两个库中，使用方法可以看一下<a href="https://chakra-ui.com/docs/theming/customize-theme">chakra文档</a>，那么这个主题是如何实现的呢？
首先 chakra ui 维护了一个default theme ,用于在没有自定义 theme 或者 自定义了一部分的theme的时候进行合并，合并的过程（<code>toCSSVar</code>）是使用了 <code>createThemeVars</code> 方法将自己配置的theme转化成css var变量，然后将默认的theme和生成的theme进行合并。最后在 :</p>
<pre><code>
export const ThemeProvider = (props: ThemeProviderProps) => {
  const { cssVarsRoot = ":host, :root", theme, children } = props
  const computedTheme = React.useMemo(() => toCSSVar(theme), [theme])
  return (
    &#x3C;EmotionThemeProvider theme={computedTheme}>
      &#x3C;Global styles={(theme: any) => ({ [cssVarsRoot]: theme.__cssVars })} />
      {children}
    &#x3C;/EmotionThemeProvider>
  )
}
</code></pre>
<p>这里是借用了 emotion 的 <a href="https://emotion.sh/docs/theming#themeprovider-reactcomponenttype">ThemeProvider</a>。这么一看其实主题设置还是很简单的。这样可以很方便的设置了一个自定义的主题
除此之外，如果想在二次开发的主题上进行三次开发，可以使用 chakra-ui 提供的api <a href="https://chakra-ui.com/docs/theming/customize-theme#using-theme-extensions">Theme extensions</a>。提供了一个类似于 HOC 的包裹函数，以withDefaultColorScheme为例：</p>
<pre><code>export function withDefaultColorScheme({colorScheme,components}): ThemeExtension {
  return (theme) => {
    let names = Object.keys(theme.components || {})
		// ....
    return mergeThemeOverride(theme, {
      components: Object.fromEntries(
        names.map((componentName) => {
          const withColorScheme = {
            defaultProps: {
              colorScheme,
            },
          }
          return [componentName, withColorScheme]
        }),
      ),
    })
  }
}
</code></pre>
<p>将配置的颜色Scheme赋值给了配置的对应的组件。内部实现大同小异，都是调用了 <code>mergeThemeOverride</code>这个方法</p>
<pre><code>export function mergeThemeOverride&#x3C;BaseTheme extends ChakraTheme = ChakraTheme>(
  ...overrides: ThemeOverride&#x3C;BaseTheme>[]
): ThemeOverride&#x3C;BaseTheme> {
  return mergeWith({}, ...overrides, mergeThemeCustomizer)
}
</code></pre>
<p>内部使用了 <code>lodash.mergewith</code>的方法实现融合，对于此方法 chakra-ui 写了一个mergeThemeCustomizer 作为 <a href="https://www.lodashjs.com/docs/lodash.mergeWith/">lodash.mergwith</a> 的第三个参数，这里的自定义mergeThemeCustomizer方法使用了递归的方式进行merge。</p>
<pre><code>
function mergeThemeCustomizer(
  source: unknown,
  override: unknown,
  key: string,
  object: any,
) {
  if (
    (isFunction(source) || isFunction(override)) &#x26;&#x26;
    Object.prototype.hasOwnProperty.call(object, key)
  ) {
    return (...args: unknown[]) => {
      const sourceValue = isFunction(source) ? source(...args) : source

      const overrideValue = isFunction(override) ? override(...args) : override

      return mergeWith({}, sourceValue, overrideValue, mergeThemeCustomizer)
    }
  }

  // fallback to default behaviour
  return undefined
}
</code></pre>
<h3>外部组件与二次封装</h3>
<p>从上面可以看到，组件库也不是全部从零开始，也使用了很多第三方的库，例如样式库 emotion， styled-components，工具方法库 lodash，这里没啥特别好说的。
另外chakra-ui官方也推荐将组件库和许多第三方的lib一起使用，例如 表单验证库<a href="https://chakra-ui.com/docs/form/form-control#usage-with-form-libraries">formik</a>，此外，在element-ui中也会直接封装throttle-debounce， async-validator等第三方的库。</p>
<h3>提供escape</h3>
<p>在使用其他的组件库的时候，很多情况下会出现某些组件的细节和设计要求不一致的情况，对于element-ui和ant design来说，由于使用了sass/less等预处理器，可以使用覆盖的方式来覆写样式。在 chakra ui 中，则提供了一个 <a href="https://chakra-ui.com/docs/features/the-sx-prop">sx Props</a> 来直接向组件传入样式。</p>
<pre><code>&#x3C;Box sx={{ "--my-color": "#53c8c4" }}>
  &#x3C;Heading color="var(--my-color)" size="lg">
    This uses CSS Custom Properties!
  &#x3C;/Heading>
&#x3C;/Box>
</code></pre>
<p>这个方式很强大，还支持嵌套样式，media query等。这里的sx是一个封装自@emotion/styled的方法，在 <a href="https://github.com/chakra-ui/chakra-ui/blob/main/packages/system/src/system.ts">packages/system/src/system.ts</a>, styled方法里面调用了 toCSSObject ，这里拿取到了输入的样式，而所有的ui 组件都会调用这个 styled方法，sx Props 就这样全局生效了。</p>
<pre><code>export function styled&#x3C;T extends As, P = {}>(
  component: T,
  options?: StyledOptions,
) {
  const { baseStyle, ...styledOptions } = options ?? {}
	// ...
  const styleObject = toCSSObject({ baseStyle })
  return _styled(
    component as React.ComponentType&#x3C;any>,
    styledOptions,
  )(styleObject) as ChakraComponent&#x3C;T, P>
}

export const toCSSObject: GetStyleObject = ({ baseStyle }) => (props) => {
  const { theme, css: cssProp, __css, sx, ...rest } = props
  const styleProps = objectFilter(rest, (_, prop) => isStyleProp(prop))
  const finalBaseStyle = runIfFn(baseStyle, props)
  const finalStyles = Object.assign({}, __css, finalBaseStyle, styleProps, sx)
  const computedCSS = css(finalStyles)(props.theme)
  return cssProp ? [computedCSS, cssProp] : computedCSS
}
</code></pre>
<h2>如何设计一个好用的组件</h2>
<p>参考了很多设计，那么如何设计一个好用的组件呢，这里以一个progressBar为例。</p>
<h3>MVP 版本以及存在的问题</h3>
<pre><code>import React, { useState, useEffect } from "react";
import styled from "styled-components";

const ProgressBarWrapper = styled.div&#x3C;{ progress: number }>`
	width: 100%;
	height: 4px;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	z-index: 9999;
	.bar-used {
		background: #34c;
		width: ${({ progress }) => progress + "%"};
		height: 100%;
		border-radius: 0 2px 2px 0;
	}
`;

const ProgressBar = () => {
	const [progress, setProgress] = useState(0);
	useEffect(() => {
		window.addEventListener("scroll", () => {
			setProgress(
				(document.documentElement.scrollTop /
					(document.body.scrollHeight - window.innerHeight)) *
					100
			);
		});
		return () => {
			window.removeEventListener("scroll", () => {});
		};
	});
	return (
		&#x3C;ProgressBarWrapper progress={progress}>
			&#x3C;div className='bar-used'>&#x3C;/div>
		&#x3C;/ProgressBarWrapper>
	);
};

export { ProgressBar };

</code></pre>
<p>这里展示了一个页面顶部进度条的组件，类似于 <a href="https://es6.ruanyifeng.com/#docs/decorator">es6标准入门</a> 这里的样式，上面的功能可以很快的就实现出来，但是只是比较符合单一的应用场景，进度条固定在顶部，只有从左往右增长一种情况。但是实际上的进度条可能会用到很多的地方，因此我们需要对照可能的场景以及代码中的变量进行判断，哪些是需要做成参数，并设置对应的默认值。
需求有以下几种：</p>
<ol>
<li>颜色可调，位置可调，方向可调，这三个是比较全局的可调整类型</li>
<li>具体样式修改，高度修改，圆角修改，这些是其他的一些props，如果保持progressbar的功能不变可能不太会用到的props</li>
</ol>
<p>此外，这里的progeressBar还存在的一个问题就是，这个组件将展示和逻辑杂糅在了一起，组件内部就有对于页面滚动进度的计算逻辑（useEffect），但是如果使用的时候不需要这个逻辑呢？
根据上面的一些要修改的点以及一些问题，我们来对这个组件进行拆分和重构。</p>
<h3>重构</h3>
<p>首先是把逻辑和展示分开。新建一个hook用于计算百分比。</p>
<pre><code>import { useState, useEffect } from "react";

export function useProgress() {
	const [progress, setProgress] = useState(0);
	useEffect(() => {
		window.addEventListener("scroll", () => {
			setProgress(
				(document.documentElement.scrollTop /
					(document.body.scrollHeight - window.innerHeight)) *
					100
			);
		});
		return () => {
			window.removeEventListener("scroll", () => {});
		};
	});
	return progress;
}

</code></pre>
<p>之后是给需要的参数添加props,并设置默认值，这里只以高度为例，设置一个可选的高度参数，当传入的时候就使用传入的值否则是默认的。
同时注意颜色等可以使用一个theme系统。</p>
<pre><code>
const ProgressBarWrapper = styled.div&#x3C;{ progress: number; height?: string }>`
	width: 100%;
	height: ${({ height }) => (height ? height : "4px")};
	.bar-used {
		background: ${({ theme }) => theme.themeColor};
		width: ${({ progress }) => progress + "%"};
		height: 100%;
		border-radius: ${({ height }) =>
			height ? `0 calc( ${height}/ 2) calc(${height}/ 2) 0` : "0 2px 2px 0"};
	}
`;
</code></pre>
<p>除此之外，将fixed布局抽象出来，方便后面进行组合</p>
<pre><code>const FixedTopWrapper = styled.div`
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	z-index: 9999;
`;
// 组合之后就是这样的
const ProgressBarWrapperFixed = styled(FixedTopWrapper)&#x3C;{
	progress: number;
	height?: string;
}>`.....`;

</code></pre>
<p>这样组件就是这样的，分成了默认好用的 ProgressBar 和 自定义功能更多的 SimpleProgressBar</p>
<pre><code>
interface ProgressProps {
	progress: number;
	height?: string;
}
const ProgressBar = ({
	height,
}: Omit&#x3C;ProgressProps, "progress">) => {
	const progress = useProgress();
	return (
		&#x3C;ProgressBarWrapperFixed progress={progress} height={height}>
			&#x3C;div className='bar-used'>&#x3C;/div>
		&#x3C;/ProgressBarWrapperFixed>
	);
};

const SimpleProgressBar = ({
	progress,
	height,
}: ProgressProps) => {
	return (
		&#x3C;ProgressBarWrapper progress={progress} height={height}>
			&#x3C;div className='bar-used'>&#x3C;/div>
		&#x3C;/ProgressBarWrapper>
	);
};
</code></pre>
<p>另外就是添加 合适的 escape，方便使用的时候如果不符合需要可以自行修改。这里直接在组件上添加一个 style参数，</p>
<pre><code>// usage
&#x3C;ProgressBar style={{ background: "#000" }}>&#x3C;/ProgressBar>
// 修改组件 添加rest参数接受附加的style,并且修改一下类型
const ProgressBar = ({
	height,
	...rest
}: Omit&#x3C;ProgressProps, "progress"> &#x26; React.HTMLAttributes&#x3C;HTMLDivElement>) => {
	const progress = useProgress();
	return (
		&#x3C;ProgressBarWrapperFixed {...rest} progress={progress} height={height}>
			&#x3C;div className='bar-used'>&#x3C;/div>
		&#x3C;/ProgressBarWrapperFixed>
	);
};
</code></pre>
<p>这样就写好了一个好用的ProgressBar组件了，并且提供了SimpleProgressBar用于其他的自定义用途。</p>
<p>在线演示：<a href="https://codepen.io/alfxjx/pen/ZEJyygo?editors=0010">https://codepen.io/alfxjx/pen/ZEJyygo?editors=0010</a></p>
<h2>总结</h2>
<p>经过上面对 chakra ui 组件库源码的研究以及一个示例，相信你以及知道了该如何设计一个好用的组件库了，希望你能为你的公司也开发一套组件库，能更好的完成你的kpi/okr/etc...</p>
<h2>Reference</h2>
<ol>
<li><a href="https://github.com/chakra-ui/chakra-ui">https://github.com/chakra-ui/chakra-ui</a></li>
<li><a href="https://chakra-ui.com/">https://chakra-ui.com/</a></li>
<li><a href="https://emotion.sh/">https://emotion.sh/</a></li>
<li><a href="https://www.lodashjs.com/">https://www.lodashjs.com/</a></li>
<li><a href="https://tailwindcss.com/">https://tailwindcss.com/</a></li>
<li><a href="https://element.eleme.cn/#/zh-CN">https://element.eleme.cn/#/zh-CN</a></li>
<li><a href="https://ant.design/index-cn">https://ant.design/index-cn</a></li>
<li><a href="https://stackoverflow.com/questions/55318165/add-styled-components-to-codepen">https://stackoverflow.com/questions/55318165/add-styled-components-to-codepen</a></li>
</ol>
</div><div id="comments"></div></div><div class="Footer__FooterWrapper-sc-1ysspqt-0 bPlNKY"><div class="my-main-font text"><span>Powerd by <a href="https://nextjs.org">Next.js</a> on<!-- --> <a href="https://vercel.com">Vercel</a> with ♥ 2020-<!-- -->2022</span></div><div class="Footer__IconList-sc-1ysspqt-1 fShAcK"><a href="https://github.com/alfxjx"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://twitter.com/alfxjx"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://weibo.com/u/1950371745"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg></a><a href="https://juejin.cn/user/2330620383728551"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.445 21.832a1 1 0 0 0 1.11 0l9-6A.998.998 0 0 0 21.8 14.4l-9-12c-.377-.504-1.223-.504-1.6 0l-9 12a1 1 0 0 0 .245 1.432l9 6zM13 19.131V6l6.565 8.754L13 19.131zM11 6v13.131l-6.565-4.377L11 6z"></path></svg></a><a href="https://umami-alfxjx.up.railway.app/share/eaSooCGG/Blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"></path></svg></a><a href="/xujianxiang-resume.pdf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-5h2v5zm4 0h-2v-3h2v3zm0-5h-2v-2h2v2zm4 5h-2V7h2v10z"></path></svg></a></div></div></div><div class="Toast__StyledContainer-sc-1p228qg-0 gWqgDn"><div class="Toastify"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"如何设计一个好用的组件-以chakra-ui为例","date":"2021-10-28T12:52:42.712Z","slug":"design-a-component","author":{"name":"Alfxjx","picture":"/assets/authors/alfxjx.jpg"},"content":"\u003cblockquote\u003e\n\u003cp\u003e同时发布于 \u003ca href=\"https://www.yuque.com/alfxjx/notes/wchz9f\"\u003e语雀\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e引子\u003c/h2\u003e\n\u003cp\u003e最近公司在搭建部门的统一平台，我负责了统一登录前端的开发，因为要对接很多的系统，所以开发了统一登录的sdk，说是sdk其实就是一个组件库。以此为契机，外加之前开发其他的系统中也用了很多种不同的组件库（饿了没-ui/vant/antd/chakra-ui...），今天写一篇文章说说，什么样的组件设计是比较合理的，以及如何设计一个好用的组件。\u003c/p\u003e\n\u003ch2\u003e研究chakra-ui\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/chakra-ui.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e比较来说我觉得设计比较有特色的一个组件库，就是 \u003ca href=\"https://chakra-ui.com/\"\u003echakra-ui\u003c/a\u003e 了，不过国内使用的并不多，我也是在之前技术选型的时候偶然找到的，但是仔细读了她的文档之后我发现这个是一个很有特色的组件库，下面细说：\u003c/p\u003e\n\u003ch3\u003e样式自定义\u003c/h3\u003e\n\u003cp\u003e找到这个 chakra-ui 的时候，就是因为需要在使用 tailwind CSS 的同时使用一个组件库，chakra-ui 的一个特色就是使用了和 tailwind CSS 几乎相同的样式 api , 例如：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eimport { Box } from \"@chakra-ui/react\"\r\n\r\n// m={2} refers to the value of `theme.space[2]`\r\n\u0026#x3C;Box m={2}\u003eTomato\u0026#x3C;/Box\u003e\r\n\r\n// You can also use custom values\r\n\u0026#x3C;Box maxW=\"960px\" mx=\"auto\" /\u003e\r\n\r\n// sets margin `8px` on all viewports and `16px` from the first breakpoint and up\r\n\u0026#x3C;Box m={[2, 3]} /\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样只要你记住了 tailwind CSS 的api， 那么就可以很快的上手 chakra-ui 。\r\n那么这个是怎么实现的呢？\r\n一开始我以为是组件库使用了tailwind CSS ，但是看了源码发现，chakra 将 styled-components 进行了二次封装，而这种 tailwindLike 的 api 是进行了模拟导致的。\r\n在 \u003ca href=\"https://github.com/chakra-ui/chakra-ui/blob/main/packages/styled-system/src/config/background.ts\"\u003e/packages/styled-system/config/\u003c/a\u003e 里面 写入了不同样式以及缩写，以 background 为例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport const background: Config = {\r\n  background: t.colors(\"background\"),\r\n  ...\r\n  bg: t.colors(\"background\"),\r\n  ...\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样实现的，可以说把dirty的工作封装了起来，展示出来的结果都是好用的。\u003c/p\u003e\n\u003ch3\u003e组件组合\u003c/h3\u003e\n\u003cp\u003e书接上文，组件里面做了很多的映射封装，为了减少代码量，统一进行管理，组件库进行了组件的组合（compose）。从一个基本的组件出发，通过默认一些样式，创造了一些新的组件。\r\n例如\u003ca href=\"https://chakra-ui.com/docs/layout/center#square-and-circle\"\u003e Square Circle \u003c/a\u003e组件，是基于 Box 组件extend而来的。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport const Square = forwardRef\u0026#x3C;SquareProps, \"div\"\u003e((props, ref) =\u003e {\r\n  const { size, centerContent = true, ...rest } = props\r\n\r\n  const styles: SystemStyleObject = centerContent\r\n    ? { display: \"flex\", alignItems: \"center\", justifyContent: \"center\" }\r\n    : {}\r\n\r\n  return (\r\n    \u0026#x3C;Box\r\n      ref={ref}\r\n      boxSize={size}\r\n      __css={{\r\n        ...styles,\r\n        flexShrink: 0,\r\n        flexGrow: 0,\r\n      }}\r\n      {...rest}\r\n    /\u003e\r\n  )\r\n})\r\n\r\nif (__DEV__) {\r\n  Square.displayName = \"Square\"\r\n}\r\n\r\nexport const Circle = forwardRef\u0026#x3C;SquareProps, \"div\"\u003e((props, ref) =\u003e {\r\n  const { size, ...rest } = props\r\n  return \u0026#x3C;Square size={size} ref={ref} borderRadius=\"9999px\" {...rest} /\u003e\r\n})\r\n\r\nif (__DEV__) {\r\n  Circle.displayName = \"Circle\"\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样写减少了重复的代码并且可以保持更好的可维护性。我们在开发的过程中也可以借鉴这种模式，开发出最抽象的组件，从这个最抽象的父类出发来进行派生。\u003c/p\u003e\n\u003ch3\u003eTheminig\u003c/h3\u003e\n\u003cp\u003echakra ui 的另外一个特点就是拥有一个高度自定义的主题系统， 使用的方式类似于 tailwind CSS \u003ca href=\"https://tailwindcss.com/docs/theme\"\u003e设置\u003c/a\u003e，也就是说你可同时将一个theme文件应用到两个库中，使用方法可以看一下\u003ca href=\"https://chakra-ui.com/docs/theming/customize-theme\"\u003echakra文档\u003c/a\u003e，那么这个主题是如何实现的呢？\r\n首先 chakra ui 维护了一个default theme ,用于在没有自定义 theme 或者 自定义了一部分的theme的时候进行合并，合并的过程（\u003ccode\u003etoCSSVar\u003c/code\u003e）是使用了 \u003ccode\u003ecreateThemeVars\u003c/code\u003e 方法将自己配置的theme转化成css var变量，然后将默认的theme和生成的theme进行合并。最后在 :\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\r\nexport const ThemeProvider = (props: ThemeProviderProps) =\u003e {\r\n  const { cssVarsRoot = \":host, :root\", theme, children } = props\r\n  const computedTheme = React.useMemo(() =\u003e toCSSVar(theme), [theme])\r\n  return (\r\n    \u0026#x3C;EmotionThemeProvider theme={computedTheme}\u003e\r\n      \u0026#x3C;Global styles={(theme: any) =\u003e ({ [cssVarsRoot]: theme.__cssVars })} /\u003e\r\n      {children}\r\n    \u0026#x3C;/EmotionThemeProvider\u003e\r\n  )\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里是借用了 emotion 的 \u003ca href=\"https://emotion.sh/docs/theming#themeprovider-reactcomponenttype\"\u003eThemeProvider\u003c/a\u003e。这么一看其实主题设置还是很简单的。这样可以很方便的设置了一个自定义的主题\r\n除此之外，如果想在二次开发的主题上进行三次开发，可以使用 chakra-ui 提供的api \u003ca href=\"https://chakra-ui.com/docs/theming/customize-theme#using-theme-extensions\"\u003eTheme extensions\u003c/a\u003e。提供了一个类似于 HOC 的包裹函数，以withDefaultColorScheme为例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport function withDefaultColorScheme({colorScheme,components}): ThemeExtension {\r\n  return (theme) =\u003e {\r\n    let names = Object.keys(theme.components || {})\r\n\t\t// ....\r\n    return mergeThemeOverride(theme, {\r\n      components: Object.fromEntries(\r\n        names.map((componentName) =\u003e {\r\n          const withColorScheme = {\r\n            defaultProps: {\r\n              colorScheme,\r\n            },\r\n          }\r\n          return [componentName, withColorScheme]\r\n        }),\r\n      ),\r\n    })\r\n  }\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e将配置的颜色Scheme赋值给了配置的对应的组件。内部实现大同小异，都是调用了 \u003ccode\u003emergeThemeOverride\u003c/code\u003e这个方法\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport function mergeThemeOverride\u0026#x3C;BaseTheme extends ChakraTheme = ChakraTheme\u003e(\r\n  ...overrides: ThemeOverride\u0026#x3C;BaseTheme\u003e[]\r\n): ThemeOverride\u0026#x3C;BaseTheme\u003e {\r\n  return mergeWith({}, ...overrides, mergeThemeCustomizer)\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e内部使用了 \u003ccode\u003elodash.mergewith\u003c/code\u003e的方法实现融合，对于此方法 chakra-ui 写了一个mergeThemeCustomizer 作为 \u003ca href=\"https://www.lodashjs.com/docs/lodash.mergeWith/\"\u003elodash.mergwith\u003c/a\u003e 的第三个参数，这里的自定义mergeThemeCustomizer方法使用了递归的方式进行merge。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\r\nfunction mergeThemeCustomizer(\r\n  source: unknown,\r\n  override: unknown,\r\n  key: string,\r\n  object: any,\r\n) {\r\n  if (\r\n    (isFunction(source) || isFunction(override)) \u0026#x26;\u0026#x26;\r\n    Object.prototype.hasOwnProperty.call(object, key)\r\n  ) {\r\n    return (...args: unknown[]) =\u003e {\r\n      const sourceValue = isFunction(source) ? source(...args) : source\r\n\r\n      const overrideValue = isFunction(override) ? override(...args) : override\r\n\r\n      return mergeWith({}, sourceValue, overrideValue, mergeThemeCustomizer)\r\n    }\r\n  }\r\n\r\n  // fallback to default behaviour\r\n  return undefined\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e外部组件与二次封装\u003c/h3\u003e\n\u003cp\u003e从上面可以看到，组件库也不是全部从零开始，也使用了很多第三方的库，例如样式库 emotion， styled-components，工具方法库 lodash，这里没啥特别好说的。\r\n另外chakra-ui官方也推荐将组件库和许多第三方的lib一起使用，例如 表单验证库\u003ca href=\"https://chakra-ui.com/docs/form/form-control#usage-with-form-libraries\"\u003eformik\u003c/a\u003e，此外，在element-ui中也会直接封装throttle-debounce， async-validator等第三方的库。\u003c/p\u003e\n\u003ch3\u003e提供escape\u003c/h3\u003e\n\u003cp\u003e在使用其他的组件库的时候，很多情况下会出现某些组件的细节和设计要求不一致的情况，对于element-ui和ant design来说，由于使用了sass/less等预处理器，可以使用覆盖的方式来覆写样式。在 chakra ui 中，则提供了一个 \u003ca href=\"https://chakra-ui.com/docs/features/the-sx-prop\"\u003esx Props\u003c/a\u003e 来直接向组件传入样式。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026#x3C;Box sx={{ \"--my-color\": \"#53c8c4\" }}\u003e\r\n  \u0026#x3C;Heading color=\"var(--my-color)\" size=\"lg\"\u003e\r\n    This uses CSS Custom Properties!\r\n  \u0026#x3C;/Heading\u003e\r\n\u0026#x3C;/Box\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这个方式很强大，还支持嵌套样式，media query等。这里的sx是一个封装自@emotion/styled的方法，在 \u003ca href=\"https://github.com/chakra-ui/chakra-ui/blob/main/packages/system/src/system.ts\"\u003epackages/system/src/system.ts\u003c/a\u003e, styled方法里面调用了 toCSSObject ，这里拿取到了输入的样式，而所有的ui 组件都会调用这个 styled方法，sx Props 就这样全局生效了。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eexport function styled\u0026#x3C;T extends As, P = {}\u003e(\r\n  component: T,\r\n  options?: StyledOptions,\r\n) {\r\n  const { baseStyle, ...styledOptions } = options ?? {}\r\n\t// ...\r\n  const styleObject = toCSSObject({ baseStyle })\r\n  return _styled(\r\n    component as React.ComponentType\u0026#x3C;any\u003e,\r\n    styledOptions,\r\n  )(styleObject) as ChakraComponent\u0026#x3C;T, P\u003e\r\n}\r\n\r\nexport const toCSSObject: GetStyleObject = ({ baseStyle }) =\u003e (props) =\u003e {\r\n  const { theme, css: cssProp, __css, sx, ...rest } = props\r\n  const styleProps = objectFilter(rest, (_, prop) =\u003e isStyleProp(prop))\r\n  const finalBaseStyle = runIfFn(baseStyle, props)\r\n  const finalStyles = Object.assign({}, __css, finalBaseStyle, styleProps, sx)\r\n  const computedCSS = css(finalStyles)(props.theme)\r\n  return cssProp ? [computedCSS, cssProp] : computedCSS\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e如何设计一个好用的组件\u003c/h2\u003e\n\u003cp\u003e参考了很多设计，那么如何设计一个好用的组件呢，这里以一个progressBar为例。\u003c/p\u003e\n\u003ch3\u003eMVP 版本以及存在的问题\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003eimport React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nconst ProgressBarWrapper = styled.div\u0026#x3C;{ progress: number }\u003e`\r\n\twidth: 100%;\r\n\theight: 4px;\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tz-index: 9999;\r\n\t.bar-used {\r\n\t\tbackground: #34c;\r\n\t\twidth: ${({ progress }) =\u003e progress + \"%\"};\r\n\t\theight: 100%;\r\n\t\tborder-radius: 0 2px 2px 0;\r\n\t}\r\n`;\r\n\r\nconst ProgressBar = () =\u003e {\r\n\tconst [progress, setProgress] = useState(0);\r\n\tuseEffect(() =\u003e {\r\n\t\twindow.addEventListener(\"scroll\", () =\u003e {\r\n\t\t\tsetProgress(\r\n\t\t\t\t(document.documentElement.scrollTop /\r\n\t\t\t\t\t(document.body.scrollHeight - window.innerHeight)) *\r\n\t\t\t\t\t100\r\n\t\t\t);\r\n\t\t});\r\n\t\treturn () =\u003e {\r\n\t\t\twindow.removeEventListener(\"scroll\", () =\u003e {});\r\n\t\t};\r\n\t});\r\n\treturn (\r\n\t\t\u0026#x3C;ProgressBarWrapper progress={progress}\u003e\r\n\t\t\t\u0026#x3C;div className='bar-used'\u003e\u0026#x3C;/div\u003e\r\n\t\t\u0026#x3C;/ProgressBarWrapper\u003e\r\n\t);\r\n};\r\n\r\nexport { ProgressBar };\r\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这里展示了一个页面顶部进度条的组件，类似于 \u003ca href=\"https://es6.ruanyifeng.com/#docs/decorator\"\u003ees6标准入门\u003c/a\u003e 这里的样式，上面的功能可以很快的就实现出来，但是只是比较符合单一的应用场景，进度条固定在顶部，只有从左往右增长一种情况。但是实际上的进度条可能会用到很多的地方，因此我们需要对照可能的场景以及代码中的变量进行判断，哪些是需要做成参数，并设置对应的默认值。\r\n需求有以下几种：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e颜色可调，位置可调，方向可调，这三个是比较全局的可调整类型\u003c/li\u003e\n\u003cli\u003e具体样式修改，高度修改，圆角修改，这些是其他的一些props，如果保持progressbar的功能不变可能不太会用到的props\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e此外，这里的progeressBar还存在的一个问题就是，这个组件将展示和逻辑杂糅在了一起，组件内部就有对于页面滚动进度的计算逻辑（useEffect），但是如果使用的时候不需要这个逻辑呢？\r\n根据上面的一些要修改的点以及一些问题，我们来对这个组件进行拆分和重构。\u003c/p\u003e\n\u003ch3\u003e重构\u003c/h3\u003e\n\u003cp\u003e首先是把逻辑和展示分开。新建一个hook用于计算百分比。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eimport { useState, useEffect } from \"react\";\r\n\r\nexport function useProgress() {\r\n\tconst [progress, setProgress] = useState(0);\r\n\tuseEffect(() =\u003e {\r\n\t\twindow.addEventListener(\"scroll\", () =\u003e {\r\n\t\t\tsetProgress(\r\n\t\t\t\t(document.documentElement.scrollTop /\r\n\t\t\t\t\t(document.body.scrollHeight - window.innerHeight)) *\r\n\t\t\t\t\t100\r\n\t\t\t);\r\n\t\t});\r\n\t\treturn () =\u003e {\r\n\t\t\twindow.removeEventListener(\"scroll\", () =\u003e {});\r\n\t\t};\r\n\t});\r\n\treturn progress;\r\n}\r\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e之后是给需要的参数添加props,并设置默认值，这里只以高度为例，设置一个可选的高度参数，当传入的时候就使用传入的值否则是默认的。\r\n同时注意颜色等可以使用一个theme系统。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\r\nconst ProgressBarWrapper = styled.div\u0026#x3C;{ progress: number; height?: string }\u003e`\r\n\twidth: 100%;\r\n\theight: ${({ height }) =\u003e (height ? height : \"4px\")};\r\n\t.bar-used {\r\n\t\tbackground: ${({ theme }) =\u003e theme.themeColor};\r\n\t\twidth: ${({ progress }) =\u003e progress + \"%\"};\r\n\t\theight: 100%;\r\n\t\tborder-radius: ${({ height }) =\u003e\r\n\t\t\theight ? `0 calc( ${height}/ 2) calc(${height}/ 2) 0` : \"0 2px 2px 0\"};\r\n\t}\r\n`;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e除此之外，将fixed布局抽象出来，方便后面进行组合\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst FixedTopWrapper = styled.div`\r\n\tposition: fixed;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n\tz-index: 9999;\r\n`;\r\n// 组合之后就是这样的\r\nconst ProgressBarWrapperFixed = styled(FixedTopWrapper)\u0026#x3C;{\r\n\tprogress: number;\r\n\theight?: string;\r\n}\u003e`.....`;\r\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样组件就是这样的，分成了默认好用的 ProgressBar 和 自定义功能更多的 SimpleProgressBar\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\r\ninterface ProgressProps {\r\n\tprogress: number;\r\n\theight?: string;\r\n}\r\nconst ProgressBar = ({\r\n\theight,\r\n}: Omit\u0026#x3C;ProgressProps, \"progress\"\u003e) =\u003e {\r\n\tconst progress = useProgress();\r\n\treturn (\r\n\t\t\u0026#x3C;ProgressBarWrapperFixed progress={progress} height={height}\u003e\r\n\t\t\t\u0026#x3C;div className='bar-used'\u003e\u0026#x3C;/div\u003e\r\n\t\t\u0026#x3C;/ProgressBarWrapperFixed\u003e\r\n\t);\r\n};\r\n\r\nconst SimpleProgressBar = ({\r\n\tprogress,\r\n\theight,\r\n}: ProgressProps) =\u003e {\r\n\treturn (\r\n\t\t\u0026#x3C;ProgressBarWrapper progress={progress} height={height}\u003e\r\n\t\t\t\u0026#x3C;div className='bar-used'\u003e\u0026#x3C;/div\u003e\r\n\t\t\u0026#x3C;/ProgressBarWrapper\u003e\r\n\t);\r\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e另外就是添加 合适的 escape，方便使用的时候如果不符合需要可以自行修改。这里直接在组件上添加一个 style参数，\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e// usage\r\n\u0026#x3C;ProgressBar style={{ background: \"#000\" }}\u003e\u0026#x3C;/ProgressBar\u003e\r\n// 修改组件 添加rest参数接受附加的style,并且修改一下类型\r\nconst ProgressBar = ({\r\n\theight,\r\n\t...rest\r\n}: Omit\u0026#x3C;ProgressProps, \"progress\"\u003e \u0026#x26; React.HTMLAttributes\u0026#x3C;HTMLDivElement\u003e) =\u003e {\r\n\tconst progress = useProgress();\r\n\treturn (\r\n\t\t\u0026#x3C;ProgressBarWrapperFixed {...rest} progress={progress} height={height}\u003e\r\n\t\t\t\u0026#x3C;div className='bar-used'\u003e\u0026#x3C;/div\u003e\r\n\t\t\u0026#x3C;/ProgressBarWrapperFixed\u003e\r\n\t);\r\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样就写好了一个好用的ProgressBar组件了，并且提供了SimpleProgressBar用于其他的自定义用途。\u003c/p\u003e\n\u003cp\u003e在线演示：\u003ca href=\"https://codepen.io/alfxjx/pen/ZEJyygo?editors=0010\"\u003ehttps://codepen.io/alfxjx/pen/ZEJyygo?editors=0010\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e总结\u003c/h2\u003e\n\u003cp\u003e经过上面对 chakra ui 组件库源码的研究以及一个示例，相信你以及知道了该如何设计一个好用的组件库了，希望你能为你的公司也开发一套组件库，能更好的完成你的kpi/okr/etc...\u003c/p\u003e\n\u003ch2\u003eReference\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/chakra-ui/chakra-ui\"\u003ehttps://github.com/chakra-ui/chakra-ui\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://chakra-ui.com/\"\u003ehttps://chakra-ui.com/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://emotion.sh/\"\u003ehttps://emotion.sh/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.lodashjs.com/\"\u003ehttps://www.lodashjs.com/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://tailwindcss.com/\"\u003ehttps://tailwindcss.com/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://element.eleme.cn/#/zh-CN\"\u003ehttps://element.eleme.cn/#/zh-CN\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ant.design/index-cn\"\u003ehttps://ant.design/index-cn\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/55318165/add-styled-components-to-codepen\"\u003ehttps://stackoverflow.com/questions/55318165/add-styled-components-to-codepen\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n","coverImage":"/assets/blog/chakra-ui.png"}},"__N_SSG":true},"page":"/tech/[slug]","query":{"slug":"design-a-component"},"buildId":"Q5-ARss9H4OnstBP8NDja","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>