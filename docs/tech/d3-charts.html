<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="/style/index.css"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&amp;display=swap"/><script async="" defer="" data-website-id="3890bdd6-8ff5-4da5-8b72-45ba24876897" src="https://umami-alfxjx.up.railway.app/umami.js"></script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2649b9740f492fab27ec.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2649b9740f492fab27ec.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8fa755d3830e88407993.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8fa755d3830e88407993.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-6c6eb080c4d41d8fd79b.js" defer=""></script><script src="/_next/static/chunks/main-4fc50673e5500481d568.js" defer=""></script><script src="/_next/static/chunks/pages/_app-075949e5fa5ffddc911e.js" defer=""></script><script src="/_next/static/chunks/252f366e-b63e9f131b12ce609c69.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-b8804bb07d4f86914404.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-eb29eaaad2b07bc95110.js" defer=""></script><script src="/_next/static/chunks/1a48c3c1-63272919e4bbaae4097e.js" defer=""></script><script src="/_next/static/chunks/608-bb5bf9a1b1d10ad22ac0.js" defer=""></script><script src="/_next/static/chunks/553-f50d93340fc41d40714e.js" defer=""></script><script src="/_next/static/chunks/307-d4f637d0181fb2085729.js" defer=""></script><script src="/_next/static/chunks/pages/tech/%5Bslug%5D-6a6947d46afa43b14f3e.js" defer=""></script><script src="/_next/static/Q5-ARss9H4OnstBP8NDja/_buildManifest.js" defer=""></script><script src="/_next/static/Q5-ARss9H4OnstBP8NDja/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap">@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrFJM.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9V1g.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJbecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJnecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJfecnFHGPc.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z11lFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z1JlFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLGT9Z1xlFd2JQEk.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="Post__Wrapper-sc-q8sq7-0 dzXARM"><div class="ProgressBar__FixedTopWrapper-sc-1ufpd9c-0 ProgressBar__ProgressBarWrapperFixed-sc-1ufpd9c-1 lmAxqe ketkUq"><div class="bar-used"></div></div><div class="header"><div class="icon-wrapper"><div class="icons"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg></div><div class="icons"><a href="/tech"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m7.375 16.781 1.25-1.562L4.601 12l4.024-3.219-1.25-1.562-5 4a1 1 0 0 0 0 1.562l5 4zm9.25-9.562-1.25 1.562L19.399 12l-4.024 3.219 1.25 1.562 5-4a1 1 0 0 0 0-1.562l-5-4zm-1.649-4.003-4 18-1.953-.434 4-18z"></path></svg></a></div></div></div><div class="toggle"><button class="switch__SwitchWrapper-sc-19ps08m-0 eMIOez"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></svg><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path></svg><div class="round"></div></button></div><div style="height:3.25rem"></div><div class="Post-sc-1u8x57o-0 Post__PostWrapper-sc-q8sq7-1 hcSpXI fqyuhB"><div class="info"><h1>[译] 如何基于 D3.js 使用外部数据源创建图表</h1><div class="user"><img class="img" src="/assets/authors/alfxjx.jpg" alt="Alfxjx"/><span class="title">Alfxjx</span><div class="date">2020-09-27</div></div></div><div class="post"><blockquote>
<ul>
<li>原文地址：<a href="https://blog.bitsrc.io/how-to-create-charts-from-external-data-sources-with-d3-js-4abbcb574706">How to Create Charts from External Data Sources with D3.js</a></li>
<li>原文作者：<a href="https://medium.com/@ds_mik">Shaumik Daityari</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md">https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md</a></li>
<li>译者：<a href="https://github.com/Alfxjx">Alfxjx</a></li>
<li>校对者：<a href="https://github.com/qq1037305420">qq1037305420</a></li>
</ul>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/12032/1*_2y7jPirLNtPHduWzlgphQ.jpeg" alt=""></p>
<p>福布斯于 2018 年年中的统计显示，人类<a href="https://www.forbes.com/sites/bernardmarr/2018/05/21/how-much-data-do-we-create-every-day-the-mind-blowing-stats-everyone-should-read/">每天约产生 2.5EB</a> 的数据。随着对如此海量数据的机器学习算法的研究，强大的可视化技术有助于将所见以一个正确的方式呈现出来。数据可视化还可以帮助读者更快地处理数据并记住数据的关键特征。在过去的十年中，对可视化专家的需求也在增加。</p>
<p>D3 是一个运行于 web 端的 Javascript 可视化库。D3 的第一个版本发布于 2011 年，并且随着社区支持的增加而成熟。对于早期版本的 D3，学习曲线有些陡峭，但对于 JavaScript 初学者来说，最新版本学习起来更容易。大多数为 Web 构建的可视化都依赖于动态数据源 —— 因此，本文的目的是使您能够在 D3 中使用外部数据源创建图表。</p>
<h2>D3 中的柱状图</h2>
<p>在 D3 中加载外部数据之前，让我们创建一个基本的柱状图，并在加载外部数据后，重新绘制该柱状图。首先，通过下面的一行代码来加载 D3 脚本。</p>
<pre><code>&#x3C;script src="https://d3js.org/d3.v5.min.js">&#x3C;/script>
</code></pre>
<p>你可能会发现，网络上的绝大部分的 D3 教程都是基于 v3 或者是 v4 版本的。但是本文中我们会使用在 2018 年的早期发布的 v5 版本的 D3 库。<a href="https://github.com/d3/d3/releases/tag/v5.12.0">最新版本的 D3 库</a>大概是一个月前发布的（译注：最新版本的 D3 发布于 2019 年的 9 月）。</p>
<p><a href="https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection">D3.js 的 changelog</a> 记录了版本之间的改动。就本文而言，需要注意 v4 与 v5 的加载方式不同。</p>
<p>首先让我们定义标题和数据。</p>
<pre><code>var title = "Comments on Posts",
	data = [
		{ type: "Post A", amount: 4 },
		{ type: "Post B", amount: 2 },
		{ type: "Post C", amount: 7 },
		{ type: "Post D", amount: 5 },
		{ type: "Post E", amount: 6 },
	];
</code></pre>
<p>在引入 D3 的脚本库之后，你可以使用全局变量 <code>d3</code> 来进行任意的有关 D3 库的操作。接着，通过将一个标题元素追加到 <code>body</code> 标签中，从而给图标添加了一个标题。如果你是在某一个确定的 <code>div</code> 标签之中创建图表的话，可在创建标题的元素之前选中该元素。另外，如果你知道标题将会保持不变，那么应该不使用 D3 而是在页面加载的时候就将其添加进来。</p>
<pre><code>d3.select("body").append("h3").text(title);
</code></pre>
<p>在继续操作之前，先添加一些自定义 CSS。</p>
<pre><code>body {
	background-color: #3c3c3c;
	color: #cfcfcf;
}

div {
	line-height: 15px;
	margin-bottom: 3px;
	background-color: grey;
}
</code></pre>
<p>此时，页面上出现了标题。你可以在样式表中为此标题定义自定义样式。接下来，在保持宽度一定的情况下，根据数据的大小设置水平柱状图的长度，创建水平柱状图。</p>
<pre><code>d3.select("body")
	.selectAll("div")
	.data(data)
	.enter()
	.append("div")
	.style("width", function (d) {
		return d.amount * 40 + "px";
	})
	.style("height", "15px");
</code></pre>
<p>这样一来你的简单柱状图就设置完成了。你可以在 <a href="https://codepen.io/shaumik/pen/RwwNLQb">CodePen</a> 上查看它。若是需要再向柱状条添加标签，可以遍历数据源从而给与之对应柱状条的 <code>div</code> 元素再添加一个文本元素。</p>
<p>现在让我们尝试使用外部文件源。</p>
<h2>从外部数据源加载数据</h2>
<p>如果数据与网页大小（平均约 2 MB），相比足够大，那么如果您声明此数据为内联，可能会通过增加加载时间而带来不便。因此，将其保存在文件中是一个好习惯。CSV（逗号分隔值）文件中的数据结构如下所示。</p>
<p>我们用于创建柱状图的外部数据已经<a href="https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv">上传到 Github</a>，CSV（逗号分隔值）文件以逗号分隔保存的数据。文件的内容如下所示：</p>
<pre><code>type,amount
Post A,4
Post B,2
Post C,7
Post D,5
Post E,6
</code></pre>
<p>在 D3 中读取 CSV 文件，可以使用 <code>csv()</code> 方法。除此之外我们还使用了 <code>d3.autoType</code> 解析函数来将文件中的行数据转换成了 JavaScript 的对象。<a href="https://github.com/d3/d3-dsv/blob/master/README.md#autoType">这个文档</a>列举了诸如将空值转换成 <code>null</code> 等之类的转换规则。你可以在加载完成之后的 <code>then()</code> 方法中用控制台打印的方式来观察转换之后的对象。</p>
<pre><code>d3.csv(
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	console.log(data);
});
</code></pre>
<p>下面展示的是在 Chrome 开发者工具的控制台中显示的转换之后的 Javascript 对象。</p>
<pre><code>(5) [{…}, {…}, {…}, {…}, {…}, columns: Array(2)]
0: {type: "Post A", amount: 4}
1: {type: "Post B", amount: 2}
2: {type: "Post C", amount: 7}
3:
  amount: 5
  type: "Post D"
  __proto__: Object
4: {type: "Post E", amount: 6}
columns: Array(2)
  0: "type"
  1: "amount"
  length: 2
  __proto__: Array(0)
  length: 5
__proto__: Array(0)
</code></pre>
<p>存在类似的功能来加载其他类型的外部文件。要加载文本文件，请使用以下代码：</p>
<pre><code>d3.text("/path/to/file.txt").then(function (text) {
	// do something
});
</code></pre>
<p>如果您的文件由其他分隔符分隔，则可以使用 <code>dsv()</code> 函数。唯一的区别是第一个参数，用于表明文件的分隔符。您也可以使用 <code>dsv()</code> 函数并使用逗号作为分隔符参数来加载 CSV 文件。</p>
<pre><code>d3.dsv(
	",",
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	console.log(data);
});
</code></pre>
<p>另外，以下的几个方法也是可选择的：</p>
<ul>
<li><code>json()</code>: to load a file containing data in JSON format</li>
<li><code>xml()</code>: to load a file containing XML data</li>
<li><code>image()</code>: to load an image</li>
<li><code>svg()</code>: to load vector graphics</li>
</ul>
<h2>使用外部数据源创建图表</h2>
<p>现在您已经成功地从外部源加载了数据，让我们创建图表。</p>
<pre><code>d3.csv(
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	d3.select("body")
		.selectAll("div")
		.data(data)
		.enter()
		.append("div")
		.style("width", function (d) {
			return d.amount * 40 + "px";
		})
		.style("height", "15px");
});
</code></pre>
<p>与前一个函数的唯一区别在于，需要在 <code>csv()</code> 函数中进行 <code>data()</code> 调用。由于列名相同，因此其余代码保持不变。</p>
<p>利用外部数据绘制的相同柱状图可以在 <a href="https://codepen.io/shaumik/pen/mGWRzm">CodePen</a> 查看。</p>
<h2>实时数据</h2>
<p>D3 的一个优点是可以通过在触发事件后更改包含图表的元素来实时更新图表。 更新图表的流程如下：</p>
<ul>
<li>捕获到事件的触发，并调用函数；</li>
<li>覆盖或更新现有数据；</li>
<li>刷新包含图表的可视元素；</li>
</ul>
<p>这里是使用 Python 和 Websockets 描述的整个过程的<a href="https://medium.com/@benjaminmbrown/real-time-data-visualization-with-d3-crossfilter-and-websockets-in-python-tutorial-dba5255e7f0e">示例</a>。</p>
<h2>最后的思考</h2>
<p>这样，我们就完成了使用 D3 从外部数据源创建图表的教程。我们首先使用 D3 创建了一个简单的柱状图，探索了从外部数据源读取数据的各种方法，最后，使用新加载的数据创建了一个图表。</p>
<blockquote>
<p>如果发现译文存在错误或其他需要改进的地方，欢迎到 <a href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 <strong>本文永久链接</strong> 即为本文在 GitHub 上的 MarkDown 链接。</p>
</blockquote>
<hr>
<blockquote>
<p><a href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 是一个翻译优质互联网技术文章的社区，文章来源为 <a href="https://juejin.im">掘金</a> 上的英文分享文章。内容覆盖 <a href="https://github.com/xitu/gold-miner#android">Android</a>、<a href="https://github.com/xitu/gold-miner#ios">iOS</a>、<a href="https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF">前端</a>、<a href="https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF">后端</a>、<a href="https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a>、<a href="https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81">产品</a>、<a href="https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1">设计</a>、<a href="https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">人工智能</a>等领域，想要查看更多优质译文请持续关注 <a href="https://github.com/xitu/gold-miner">掘金翻译计划</a>、<a href="http://weibo.com/juejinfanyi">官方微博</a>、<a href="https://zhuanlan.zhihu.com/juejinfanyi">知乎专栏</a>。</p>
</blockquote>
</div><div id="comments"></div></div><div class="Footer__FooterWrapper-sc-1ysspqt-0 bPlNKY"><div class="my-main-font text"><span>Powerd by <a href="https://nextjs.org">Next.js</a> on<!-- --> <a href="https://vercel.com">Vercel</a> with ♥ 2020-<!-- -->2022</span></div><div class="Footer__IconList-sc-1ysspqt-1 fShAcK"><a href="https://github.com/alfxjx"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://twitter.com/alfxjx"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://weibo.com/u/1950371745"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8.3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4.6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"></path></svg></a><a href="https://juejin.cn/user/2330620383728551"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M11.445 21.832a1 1 0 0 0 1.11 0l9-6A.998.998 0 0 0 21.8 14.4l-9-12c-.377-.504-1.223-.504-1.6 0l-9 12a1 1 0 0 0 .245 1.432l9 6zM13 19.131V6l6.565 8.754L13 19.131zM11 6v13.131l-6.565-4.377L11 6z"></path></svg></a><a href="https://umami-alfxjx.up.railway.app/share/eaSooCGG/Blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path d="M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z"></path></svg></a><a href="/xujianxiang-resume.pdf"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" height="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0z"></path><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-5h2v5zm4 0h-2v-3h2v3zm0-5h-2v-2h2v2zm4 5h-2V7h2v10z"></path></svg></a></div></div></div><div class="Toast__StyledContainer-sc-1p228qg-0 gWqgDn"><div class="Toastify"></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"[译] 如何基于 D3.js 使用外部数据源创建图表","date":"2020-09-27T08:18:39.741Z","slug":"d3-charts","author":{"name":"Alfxjx","picture":"/assets/authors/alfxjx.jpg"},"content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca href=\"https://blog.bitsrc.io/how-to-create-charts-from-external-data-sources-with-d3-js-4abbcb574706\"\u003eHow to Create Charts from External Data Sources with D3.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca href=\"https://medium.com/@ds_mik\"\u003eShaumik Daityari\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca href=\"https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca href=\"https://github.com/Alfxjx\"\u003eAlfxjx\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca href=\"https://github.com/qq1037305420\"\u003eqq1037305420\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/12032/1*_2y7jPirLNtPHduWzlgphQ.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e福布斯于 2018 年年中的统计显示，人类\u003ca href=\"https://www.forbes.com/sites/bernardmarr/2018/05/21/how-much-data-do-we-create-every-day-the-mind-blowing-stats-everyone-should-read/\"\u003e每天约产生 2.5EB\u003c/a\u003e 的数据。随着对如此海量数据的机器学习算法的研究，强大的可视化技术有助于将所见以一个正确的方式呈现出来。数据可视化还可以帮助读者更快地处理数据并记住数据的关键特征。在过去的十年中，对可视化专家的需求也在增加。\u003c/p\u003e\n\u003cp\u003eD3 是一个运行于 web 端的 Javascript 可视化库。D3 的第一个版本发布于 2011 年，并且随着社区支持的增加而成熟。对于早期版本的 D3，学习曲线有些陡峭，但对于 JavaScript 初学者来说，最新版本学习起来更容易。大多数为 Web 构建的可视化都依赖于动态数据源 —— 因此，本文的目的是使您能够在 D3 中使用外部数据源创建图表。\u003c/p\u003e\n\u003ch2\u003eD3 中的柱状图\u003c/h2\u003e\n\u003cp\u003e在 D3 中加载外部数据之前，让我们创建一个基本的柱状图，并在加载外部数据后，重新绘制该柱状图。首先，通过下面的一行代码来加载 D3 脚本。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026#x3C;script src=\"https://d3js.org/d3.v5.min.js\"\u003e\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e你可能会发现，网络上的绝大部分的 D3 教程都是基于 v3 或者是 v4 版本的。但是本文中我们会使用在 2018 年的早期发布的 v5 版本的 D3 库。\u003ca href=\"https://github.com/d3/d3/releases/tag/v5.12.0\"\u003e最新版本的 D3 库\u003c/a\u003e大概是一个月前发布的（译注：最新版本的 D3 发布于 2019 年的 9 月）。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection\"\u003eD3.js 的 changelog\u003c/a\u003e 记录了版本之间的改动。就本文而言，需要注意 v4 与 v5 的加载方式不同。\u003c/p\u003e\n\u003cp\u003e首先让我们定义标题和数据。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003evar title = \"Comments on Posts\",\r\n\tdata = [\r\n\t\t{ type: \"Post A\", amount: 4 },\r\n\t\t{ type: \"Post B\", amount: 2 },\r\n\t\t{ type: \"Post C\", amount: 7 },\r\n\t\t{ type: \"Post D\", amount: 5 },\r\n\t\t{ type: \"Post E\", amount: 6 },\r\n\t];\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在引入 D3 的脚本库之后，你可以使用全局变量 \u003ccode\u003ed3\u003c/code\u003e 来进行任意的有关 D3 库的操作。接着，通过将一个标题元素追加到 \u003ccode\u003ebody\u003c/code\u003e 标签中，从而给图标添加了一个标题。如果你是在某一个确定的 \u003ccode\u003ediv\u003c/code\u003e 标签之中创建图表的话，可在创建标题的元素之前选中该元素。另外，如果你知道标题将会保持不变，那么应该不使用 D3 而是在页面加载的时候就将其添加进来。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.select(\"body\").append(\"h3\").text(title);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在继续操作之前，先添加一些自定义 CSS。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ebody {\r\n\tbackground-color: #3c3c3c;\r\n\tcolor: #cfcfcf;\r\n}\r\n\r\ndiv {\r\n\tline-height: 15px;\r\n\tmargin-bottom: 3px;\r\n\tbackground-color: grey;\r\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e此时，页面上出现了标题。你可以在样式表中为此标题定义自定义样式。接下来，在保持宽度一定的情况下，根据数据的大小设置水平柱状图的长度，创建水平柱状图。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.select(\"body\")\r\n\t.selectAll(\"div\")\r\n\t.data(data)\r\n\t.enter()\r\n\t.append(\"div\")\r\n\t.style(\"width\", function (d) {\r\n\t\treturn d.amount * 40 + \"px\";\r\n\t})\r\n\t.style(\"height\", \"15px\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样一来你的简单柱状图就设置完成了。你可以在 \u003ca href=\"https://codepen.io/shaumik/pen/RwwNLQb\"\u003eCodePen\u003c/a\u003e 上查看它。若是需要再向柱状条添加标签，可以遍历数据源从而给与之对应柱状条的 \u003ccode\u003ediv\u003c/code\u003e 元素再添加一个文本元素。\u003c/p\u003e\n\u003cp\u003e现在让我们尝试使用外部文件源。\u003c/p\u003e\n\u003ch2\u003e从外部数据源加载数据\u003c/h2\u003e\n\u003cp\u003e如果数据与网页大小（平均约 2 MB），相比足够大，那么如果您声明此数据为内联，可能会通过增加加载时间而带来不便。因此，将其保存在文件中是一个好习惯。CSV（逗号分隔值）文件中的数据结构如下所示。\u003c/p\u003e\n\u003cp\u003e我们用于创建柱状图的外部数据已经\u003ca href=\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\"\u003e上传到 Github\u003c/a\u003e，CSV（逗号分隔值）文件以逗号分隔保存的数据。文件的内容如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etype,amount\r\nPost A,4\r\nPost B,2\r\nPost C,7\r\nPost D,5\r\nPost E,6\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 D3 中读取 CSV 文件，可以使用 \u003ccode\u003ecsv()\u003c/code\u003e 方法。除此之外我们还使用了 \u003ccode\u003ed3.autoType\u003c/code\u003e 解析函数来将文件中的行数据转换成了 JavaScript 的对象。\u003ca href=\"https://github.com/d3/d3-dsv/blob/master/README.md#autoType\"\u003e这个文档\u003c/a\u003e列举了诸如将空值转换成 \u003ccode\u003enull\u003c/code\u003e 等之类的转换规则。你可以在加载完成之后的 \u003ccode\u003ethen()\u003c/code\u003e 方法中用控制台打印的方式来观察转换之后的对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.csv(\r\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\r\n\td3.autoType\r\n).then(function (data) {\r\n\tconsole.log(data);\r\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下面展示的是在 Chrome 开发者工具的控制台中显示的转换之后的 Javascript 对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e(5) [{…}, {…}, {…}, {…}, {…}, columns: Array(2)]\r\n0: {type: \"Post A\", amount: 4}\r\n1: {type: \"Post B\", amount: 2}\r\n2: {type: \"Post C\", amount: 7}\r\n3:\r\n  amount: 5\r\n  type: \"Post D\"\r\n  __proto__: Object\r\n4: {type: \"Post E\", amount: 6}\r\ncolumns: Array(2)\r\n  0: \"type\"\r\n  1: \"amount\"\r\n  length: 2\r\n  __proto__: Array(0)\r\n  length: 5\r\n__proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在类似的功能来加载其他类型的外部文件。要加载文本文件，请使用以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.text(\"/path/to/file.txt\").then(function (text) {\r\n\t// do something\r\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果您的文件由其他分隔符分隔，则可以使用 \u003ccode\u003edsv()\u003c/code\u003e 函数。唯一的区别是第一个参数，用于表明文件的分隔符。您也可以使用 \u003ccode\u003edsv()\u003c/code\u003e 函数并使用逗号作为分隔符参数来加载 CSV 文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.dsv(\r\n\t\",\",\r\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\r\n\td3.autoType\r\n).then(function (data) {\r\n\tconsole.log(data);\r\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e另外，以下的几个方法也是可选择的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ejson()\u003c/code\u003e: to load a file containing data in JSON format\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003exml()\u003c/code\u003e: to load a file containing XML data\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eimage()\u003c/code\u003e: to load an image\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esvg()\u003c/code\u003e: to load vector graphics\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e使用外部数据源创建图表\u003c/h2\u003e\n\u003cp\u003e现在您已经成功地从外部源加载了数据，让我们创建图表。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ed3.csv(\r\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\r\n\td3.autoType\r\n).then(function (data) {\r\n\td3.select(\"body\")\r\n\t\t.selectAll(\"div\")\r\n\t\t.data(data)\r\n\t\t.enter()\r\n\t\t.append(\"div\")\r\n\t\t.style(\"width\", function (d) {\r\n\t\t\treturn d.amount * 40 + \"px\";\r\n\t\t})\r\n\t\t.style(\"height\", \"15px\");\r\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e与前一个函数的唯一区别在于，需要在 \u003ccode\u003ecsv()\u003c/code\u003e 函数中进行 \u003ccode\u003edata()\u003c/code\u003e 调用。由于列名相同，因此其余代码保持不变。\u003c/p\u003e\n\u003cp\u003e利用外部数据绘制的相同柱状图可以在 \u003ca href=\"https://codepen.io/shaumik/pen/mGWRzm\"\u003eCodePen\u003c/a\u003e 查看。\u003c/p\u003e\n\u003ch2\u003e实时数据\u003c/h2\u003e\n\u003cp\u003eD3 的一个优点是可以通过在触发事件后更改包含图表的元素来实时更新图表。 更新图表的流程如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e捕获到事件的触发，并调用函数；\u003c/li\u003e\n\u003cli\u003e覆盖或更新现有数据；\u003c/li\u003e\n\u003cli\u003e刷新包含图表的可视元素；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这里是使用 Python 和 Websockets 描述的整个过程的\u003ca href=\"https://medium.com/@benjaminmbrown/real-time-data-visualization-with-d3-crossfilter-and-websockets-in-python-tutorial-dba5255e7f0e\"\u003e示例\u003c/a\u003e。\u003c/p\u003e\n\u003ch2\u003e最后的思考\u003c/h2\u003e\n\u003cp\u003e这样，我们就完成了使用 D3 从外部数据源创建图表的教程。我们首先使用 D3 创建了一个简单的柱状图，探索了从外部数据源读取数据的各种方法，最后，使用新加载的数据创建了一个图表。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果发现译文存在错误或其他需要改进的地方，欢迎到 \u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 \u003cstrong\u003e本文永久链接\u003c/strong\u003e 即为本文在 GitHub 上的 MarkDown 链接。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","coverImage":"/assets/blog/d3.png"}},"__N_SSG":true},"page":"/tech/[slug]","query":{"slug":"d3-charts"},"buildId":"Q5-ARss9H4OnstBP8NDja","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>