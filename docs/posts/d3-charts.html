<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/68b325cd48e1bda6f336.css" as="style"/><link rel="stylesheet" href="/_next/static/css/68b325cd48e1bda6f336.css" data-n-g=""/><link rel="preload" href="/_next/static/css/8fa755d3830e88407993.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8fa755d3830e88407993.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/_next/static/chunks/main-588261c74baf7142d208.js" defer=""></script><script src="/_next/static/chunks/pages/_app-503127f480ee755773f7.js" defer=""></script><script src="/_next/static/chunks/218-be0f6d44c2de012fd6c8.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-8e5c32bc30f28094e059.js" defer=""></script><script src="/_next/static/zlhWgocm1rjUbN_It-MYj/_buildManifest.js" defer=""></script><script src="/_next/static/zlhWgocm1rjUbN_It-MYj/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="slug__Wrapper-sc-zxcg8a-0 cMgnaS"><div class="header"><div><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8c-14.7 12.8-14.7 35.6 0 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"></path></svg></div><button class="Button__InsideButton-sc-19071w6-0 bDiDPB">light</button></div><div style="height:3.25rem"></div><div class="Post-sc-1u8x57o-0 slug__PostWrapper-sc-zxcg8a-1 fRfPOo dyTbUk"><h1>[译] 如何基于 D3.js 使用外部数据源创建图表</h1><div class="post"><blockquote>
<ul>
<li>原文地址：<a href="https://blog.bitsrc.io/how-to-create-charts-from-external-data-sources-with-d3-js-4abbcb574706">How to Create Charts from External Data Sources with D3.js</a></li>
<li>原文作者：<a href="https://medium.com/@ds_mik">Shaumik Daityari</a></li>
<li>译文出自：<a href="https://github.com/xitu/gold-miner">掘金翻译计划</a></li>
<li>本文永久链接：<a href="https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md">https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md</a></li>
<li>译者：<a href="https://github.com/Alfxjx">Alfxjx</a></li>
<li>校对者：<a href="https://github.com/qq1037305420">qq1037305420</a></li>
</ul>
</blockquote>
<p><img src="https://cdn-images-1.medium.com/max/12032/1*_2y7jPirLNtPHduWzlgphQ.jpeg" alt=""></p>
<p>福布斯于 2018 年年中的统计显示，人类<a href="https://www.forbes.com/sites/bernardmarr/2018/05/21/how-much-data-do-we-create-every-day-the-mind-blowing-stats-everyone-should-read/">每天约产生 2.5EB</a> 的数据。随着对如此海量数据的机器学习算法的研究，强大的可视化技术有助于将所见以一个正确的方式呈现出来。数据可视化还可以帮助读者更快地处理数据并记住数据的关键特征。在过去的十年中，对可视化专家的需求也在增加。</p>
<p>D3 是一个运行于 web 端的 Javascript 可视化库。D3 的第一个版本发布于 2011 年，并且随着社区支持的增加而成熟。对于早期版本的 D3，学习曲线有些陡峭，但对于 JavaScript 初学者来说，最新版本学习起来更容易。大多数为 Web 构建的可视化都依赖于动态数据源 —— 因此，本文的目的是使您能够在 D3 中使用外部数据源创建图表。</p>
<h2>D3 中的柱状图</h2>
<p>在 D3 中加载外部数据之前，让我们创建一个基本的柱状图，并在加载外部数据后，重新绘制该柱状图。首先，通过下面的一行代码来加载 D3 脚本。</p>
<pre><code class="language-html">&#x3C;script src="https://d3js.org/d3.v5.min.js">&#x3C;/script>
</code></pre>
<p>你可能会发现，网络上的绝大部分的 D3 教程都是基于 v3 或者是 v4 版本的。但是本文中我们会使用在 2018 年的早期发布的 v5 版本的 D3 库。<a href="https://github.com/d3/d3/releases/tag/v5.12.0">最新版本的 D3 库</a>大概是一个月前发布的（译注：最新版本的 D3 发布于 2019 年的 9 月）。</p>
<p><a href="https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection">D3.js 的 changelog</a> 记录了版本之间的改动。就本文而言，需要注意 v4 与 v5 的加载方式不同。</p>
<p>首先让我们定义标题和数据。</p>
<pre><code class="language-js">var title = "Comments on Posts",
	data = [
		{ type: "Post A", amount: 4 },
		{ type: "Post B", amount: 2 },
		{ type: "Post C", amount: 7 },
		{ type: "Post D", amount: 5 },
		{ type: "Post E", amount: 6 },
	];
</code></pre>
<p>在引入 D3 的脚本库之后，你可以使用全局变量 <code>d3</code> 来进行任意的有关 D3 库的操作。接着，通过将一个标题元素追加到 <code>body</code> 标签中，从而给图标添加了一个标题。如果你是在某一个确定的 <code>div</code> 标签之中创建图表的话，可在创建标题的元素之前选中该元素。另外，如果你知道标题将会保持不变，那么应该不使用 D3 而是在页面加载的时候就将其添加进来。</p>
<pre><code class="language-js">d3.select("body").append("h3").text(title);
</code></pre>
<p>在继续操作之前，先添加一些自定义 CSS。</p>
<pre><code class="language-css">body {
	background-color: #3c3c3c;
	color: #cfcfcf;
}

div {
	line-height: 15px;
	margin-bottom: 3px;
	background-color: grey;
}
</code></pre>
<p>此时，页面上出现了标题。你可以在样式表中为此标题定义自定义样式。接下来，在保持宽度一定的情况下，根据数据的大小设置水平柱状图的长度，创建水平柱状图。</p>
<pre><code class="language-js">d3.select("body")
	.selectAll("div")
	.data(data)
	.enter()
	.append("div")
	.style("width", function (d) {
		return d.amount * 40 + "px";
	})
	.style("height", "15px");
</code></pre>
<p>这样一来你的简单柱状图就设置完成了。你可以在 <a href="https://codepen.io/shaumik/pen/RwwNLQb">CodePen</a> 上查看它。若是需要再向柱状条添加标签，可以遍历数据源从而给与之对应柱状条的 <code>div</code> 元素再添加一个文本元素。</p>
<p>现在让我们尝试使用外部文件源。</p>
<h2>从外部数据源加载数据</h2>
<p>如果数据与网页大小（平均约 2 MB），相比足够大，那么如果您声明此数据为内联，可能会通过增加加载时间而带来不便。因此，将其保存在文件中是一个好习惯。CSV（逗号分隔值）文件中的数据结构如下所示。</p>
<p>我们用于创建柱状图的外部数据已经<a href="https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv">上传到 Github</a>，CSV（逗号分隔值）文件以逗号分隔保存的数据。文件的内容如下所示：</p>
<pre><code>type,amount
Post A,4
Post B,2
Post C,7
Post D,5
Post E,6
</code></pre>
<p>在 D3 中读取 CSV 文件，可以使用 <code>csv()</code> 方法。除此之外我们还使用了 <code>d3.autoType</code> 解析函数来将文件中的行数据转换成了 JavaScript 的对象。<a href="https://github.com/d3/d3-dsv/blob/master/README.md#autoType">这个文档</a>列举了诸如将空值转换成 <code>null</code> 等之类的转换规则。你可以在加载完成之后的 <code>then()</code> 方法中用控制台打印的方式来观察转换之后的对象。</p>
<pre><code class="language-js">d3.csv(
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	console.log(data);
});
</code></pre>
<p>下面展示的是在 Chrome 开发者工具的控制台中显示的转换之后的 Javascript 对象。</p>
<pre><code>(5) [{…}, {…}, {…}, {…}, {…}, columns: Array(2)]
0: {type: "Post A", amount: 4}
1: {type: "Post B", amount: 2}
2: {type: "Post C", amount: 7}
3:
  amount: 5
  type: "Post D"
  __proto__: Object
4: {type: "Post E", amount: 6}
columns: Array(2)
  0: "type"
  1: "amount"
  length: 2
  __proto__: Array(0)
  length: 5
__proto__: Array(0)
</code></pre>
<p>存在类似的功能来加载其他类型的外部文件。要加载文本文件，请使用以下代码：</p>
<pre><code class="language-js">d3.text("/path/to/file.txt").then(function (text) {
	// do something
});
</code></pre>
<p>如果您的文件由其他分隔符分隔，则可以使用 <code>dsv()</code> 函数。唯一的区别是第一个参数，用于表明文件的分隔符。您也可以使用 <code>dsv()</code> 函数并使用逗号作为分隔符参数来加载 CSV 文件。</p>
<pre><code class="language-js">d3.dsv(
	",",
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	console.log(data);
});
</code></pre>
<p>另外，以下的几个方法也是可选择的：</p>
<ul>
<li><code>json()</code>: to load a file containing data in JSON format</li>
<li><code>xml()</code>: to load a file containing XML data</li>
<li><code>image()</code>: to load an image</li>
<li><code>svg()</code>: to load vector graphics</li>
</ul>
<h2>使用外部数据源创建图表</h2>
<p>现在您已经成功地从外部源加载了数据，让我们创建图表。</p>
<pre><code class="language-js">d3.csv(
	"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv",
	d3.autoType
).then(function (data) {
	d3.select("body")
		.selectAll("div")
		.data(data)
		.enter()
		.append("div")
		.style("width", function (d) {
			return d.amount * 40 + "px";
		})
		.style("height", "15px");
});
</code></pre>
<p>与前一个函数的唯一区别在于，需要在 <code>csv()</code> 函数中进行 <code>data()</code> 调用。由于列名相同，因此其余代码保持不变。</p>
<p>利用外部数据绘制的相同柱状图可以在 <a href="https://codepen.io/shaumik/pen/mGWRzm">CodePen</a> 查看。</p>
<h2>实时数据</h2>
<p>D3 的一个优点是可以通过在触发事件后更改包含图表的元素来实时更新图表。 更新图表的流程如下：</p>
<ul>
<li>捕获到事件的触发，并调用函数；</li>
<li>覆盖或更新现有数据；</li>
<li>刷新包含图表的可视元素；</li>
</ul>
<p>这里是使用 Python 和 Websockets 描述的整个过程的<a href="https://medium.com/@benjaminmbrown/real-time-data-visualization-with-d3-crossfilter-and-websockets-in-python-tutorial-dba5255e7f0e">示例</a>。</p>
<h2>最后的思考</h2>
<p>这样，我们就完成了使用 D3 从外部数据源创建图表的教程。我们首先使用 D3 创建了一个简单的柱状图，探索了从外部数据源读取数据的各种方法，最后，使用新加载的数据创建了一个图表。</p>
<blockquote>
<p>如果发现译文存在错误或其他需要改进的地方，欢迎到 <a href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 <strong>本文永久链接</strong> 即为本文在 GitHub 上的 MarkDown 链接。</p>
</blockquote>
<hr>
<blockquote>
<p><a href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 是一个翻译优质互联网技术文章的社区，文章来源为 <a href="https://juejin.im">掘金</a> 上的英文分享文章。内容覆盖 <a href="https://github.com/xitu/gold-miner#android">Android</a>、<a href="https://github.com/xitu/gold-miner#ios">iOS</a>、<a href="https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF">前端</a>、<a href="https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF">后端</a>、<a href="https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a>、<a href="https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81">产品</a>、<a href="https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1">设计</a>、<a href="https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">人工智能</a>等领域，想要查看更多优质译文请持续关注 <a href="https://github.com/xitu/gold-miner">掘金翻译计划</a>、<a href="http://weibo.com/juejinfanyi">官方微博</a>、<a href="https://zhuanlan.zhihu.com/juejinfanyi">知乎专栏</a>。</p>
</blockquote>
</div></div><div class="Footer__FooterWrapper-sc-1ysspqt-0 dduiPc"><div class="my-main-font text"><span>Powerd by Next.js on gh-pages, </span><a href="http://www.anbandon.work">More in old blog</a></div><div class="Footer__IconList-sc-1ysspqt-1 iXsBAW"><a href="https://github.com/alfxjx"><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="32" height="32"><defs><style></style></defs><path d="M960 512c0 97.76-28.704 185.216-85.664 263.264-56.96 78.016-130.496 131.84-220.64 161.856-10.304 1.824-18.368.448-22.848-4.032a22.4 22.4 0 0 1-7.2-17.504v-122.88c0-37.632-10.304-65.44-30.464-82.912a409.856 409.856 0 0 0 59.616-10.368 222.752 222.752 0 0 0 54.72-22.816c18.848-10.784 34.528-23.36 47.104-38.592 12.544-15.232 22.848-35.904 30.912-61.44 8.096-25.568 12.128-54.688 12.128-87.904 0-47.072-15.232-86.976-46.208-120.16 14.368-35.456 13.024-74.912-4.48-118.848-10.752-3.616-26.432-1.344-47.072 6.272s-38.56 16.16-53.824 25.568l-21.984 13.888C587.776 285.088 550.56 280.16 512 280.16s-75.776 4.928-112.096 15.232a444.48 444.48 0 0 0-24.672-15.68c-10.336-6.272-26.464-13.888-48.896-22.432-21.952-8.96-39.008-11.232-50.24-8.064-17.024 43.936-18.368 83.424-4.032 118.848-30.496 33.632-46.176 73.536-46.176 120.608 0 33.216 4.032 62.336 12.128 87.456 8.032 25.12 18.368 45.76 30.496 61.44 12.544 15.68 28.224 28.704 47.072 39.04 18.848 10.304 37.216 17.92 54.72 22.816a409.6 409.6 0 0 0 59.648 10.368c-15.712 13.856-25.12 34.048-28.704 60.064a99.744 99.744 0 0 1-26.464 8.512 178.208 178.208 0 0 1-33.184 2.688c-13.024 0-25.568-4.032-38.144-12.544-12.544-8.512-23.296-20.64-32.256-36.32a97.472 97.472 0 0 0-28.256-30.496c-11.232-8.064-21.088-12.576-28.704-13.92l-11.648-1.792c-8.096 0-13.92.928-17.056 2.688-3.136 1.792-4.032 4.032-2.688 6.72s3.136 5.408 5.376 8.096 4.928 4.928 7.616 7.168l4.032 2.688c8.544 4.032 17.056 11.232 25.568 21.984 8.544 10.752 14.368 20.64 18.4 29.6l5.824 13.44c4.928 14.816 13.44 26.912 25.568 35.872 12.096 8.992 25.088 14.816 39.008 17.504 13.888 2.688 27.36 4.032 40.352 4.032s23.776-.448 32.288-2.24l13.472-2.24c0 14.784 0 32.288.416 52.032 0 19.744.48 30.496.48 31.392a22.624 22.624 0 0 1-7.648 17.472c-4.928 4.48-12.992 5.824-23.296 4.032-90.144-30.048-163.68-83.84-220.64-161.888C92.256 697.216 64 609.312 64 512c0-81.152 20.192-156.064 60.096-224.672s94.176-122.88 163.232-163.232C355.936 84.192 430.816 64 512 64s156.064 20.192 224.672 60.096 122.88 94.176 163.232 163.232C939.808 355.488 960 430.848 960 512"></path></svg></a><a href="https://weibo.com/u/1950371745"><svg class="icon" viewBox="0 0 1026 1024" xmlns="http://www.w3.org/2000/svg" width="32.063" height="32"><defs><style></style></defs><path d="M0 61.5zM780 577c-11-2-18-5.5-21-9.5-3-4.5-4-8-1.5-12l3-5.5c.5-.5 1.5-2 2-3 .5-1.5 2-4.5 4.5-9 2-4.5 4-9.5 5-14s2-10.5 2.5-17 .5-13.5-.5-19.5-3-12.5-6.5-20c-3.5-7-7.5-13.5-13.5-19.5-10-10-23-16.5-39.5-19.5-16-3-32.5-3-48.5-.5s-31.5 5.5-45.5 9.5c-14.5 4-26 7.5-35.5 11.5l-14 6.5c-7 2-13 3.5-18 4.5-4.5.5-8.5.5-11-.5s-4.5-2-6-3-2-3.5-1.5-7.5.5-7.5 1-10c.5-3 1.5-7.5 2.5-13.5 1.5-6 2.5-11 3-14.5 0-8.5-.5-16.5-1.5-24s-3.5-16-7-25.5-9-17-15.5-22.5c-7-5.5-15.5-10.5-26-14s-24-4.5-40.5-3-35 5.5-56 13c-25 8.5-50.5 21.5-76.5 38-26 17-48 34.5-67 52.5-19 18.5-36.5 36-52 53.5-16 17-28 31-36.5 42l-12 17c-23.5 31-41 61.5-52.5 92.5s-17 54-16 70V723c4.5 34.5 15 65.5 31.5 92.5 17 27.5 37 49.5 60 66 23.5 17 51 31 82.5 43s62 20.5 91 26 59.5 9 92 11.5c53 4.5 108 0 165-12.5s110-34.5 159-65c49-31 84-68 104-111 12-25 18.5-49 19-71s-3.5-40.5-11.5-54.5-18-26.5-30.5-37c-12.5-11-24.5-18.5-35.5-23.5-10-6-20-9.5-28.5-10.5zM452 911.5c-77.5 3.5-143.5-11.5-197.5-45s-81-76.5-81-128c0-51 27-95 80.5-132s120-57 198-61S596 555 650 584s80.5 69.5 80.5 120.5c0 51.5-27.5 98-82.5 139.5s-120 64-196 67.5zm-31.5-298c-21 2-39.5 7-56 14.5S335 644 326 654c-9.5 9.5-17 20-23.5 31s-11 22-13.5 33-4 20.5-5 29.5c-.5 9-1 16-1 21l1 8.5v4.5c0 2 .5 6.5 2 13s3.5 12.5 6 18 6.5 11.5 12.5 18 12.5 12 20.5 16c47.5 23 91.5 30 132.5 21s74-29.5 99-62c10-12 16.5-27.5 20-45 3-18 2.5-36-2-54.5s-12.5-35-24-50-28.5-26.5-51-35c-23.5-9-49.5-11-79-7.5zM382 817c-4.5.5-8.5 1-12.5.5s-7.5-1-11-2-6.5-2.5-9.5-4-6-3.5-8-6l-6-7.5c-2-2.5-3-5.5-4.5-8.5s-1.5-6.5-1.5-10c0-8 2-15.5 6.5-23s10-14 18-19.5c7.5-5.5 16-8.5 25.5-9 6.5-.5 12.5-.5 19 .5 6 1 11.5 3 15.5 5.5 4.5 2.5 8 5.5 11.5 8.5 3 3 5.5 7 7 11.5s2 9 2 14c0 8-2.5 15.5-7 22.5S416 804 408 809c-8 4-16.5 7-26 8zm91.5-77.5c-5 3.5-10 5-15.5 5-5.5-.5-9-2.5-11.5-7l-2-4.5c-.5-1.5-1-3-1-4.5V724c0-2 .5-4 1-5.5l2-4.5c.5-1.5 2-2.5 3-3l3-4.5c5.5-4.5 11.5-6 16.5-5.5s9 3.5 11.5 8.5c2 3 3 6 2.5 9.5s-1.5 7-3 10c-1.5 4.5-4 7.5-6.5 10.5zm382-225c4.5 0 8.5-1 12-3s6.5-5 8.5-8 3.5-6.5 4.5-10c.5-.5 1-2 1-3 8.5-82-20-128.5-86-140-19.5-3.5-37.5-4-54-1-5 0-9.5 1.5-13 4s-6.5 5.5-9 9.5-4 8-4 12.5c0 7 2.5 13.5 7.5 18.5s11 7.5 18.5 7.5c56-13 86 5 90.5 54 1.5 12 .5 23.5-2 34.5 0 7 2.5 13.5 7.5 18.5 4.5 3.5 10.5 6 18 6zM837 211c-31.5-7-74-5.5-127 4.5-.5 0-1.5.5-2 1l-1 2-1 1c-8 2-14.5 6.5-19.5 13.5s-7.5 14-7.5 22c0 11 3.5 19.5 11 27 7 7 16 11 26 11h3c.5 0 2.5-.5 5-1s5-1.5 8-1.5c3-.5 6-1 9-2s6-2 8.5-3S757 284 764 284s16 .5 26.5 1.5 22 4 34.5 8c12.5 4.5 25 9.5 37.5 16s25 15.5 37.5 27 23.5 24.5 33 40c18.5 42.5 22.5 83 11 122.5 0 .5 0 1.5-.5 2s-1 2.5-1.5 5.5-1.5 5.5-2 8-1.5 5.5-2 9.5-1 7.5-1 10c0 6.5 2 12 5.5 16 3.5 4.5 8 7.5 13.5 9 5.5 2 11.5 2.5 19 2.5 20 0 32-12 35.5-36.5 8.5-28 13.5-54.5 14.5-80s-.5-48-5.5-67c-4.5-19.5-11.5-37.5-21-54.5s-20-31-32.5-43c-12-12-26-22.5-41-32.5-15-9.5-29.5-17.5-43.5-23-15-5.5-29.5-10.5-44.5-14z"></path></svg></a><a href="https://juejin.cn/user/2330620383728551"><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><defs><style></style></defs><path d="M832 739.533h57.958v30.105H587.571v-30.105h48.538l-31.54-184.525-.819-4.506 4.608-.716 21.095-3.482 4.505-.717.82 4.506 32.46 189.645h49.87V510.874H571.391v-30.106h145.613V381.44H619.93v-30.106h228.556v30.106H747.52v99.328h162.918v30.106H747.622v228.659h53.453l32.461-189.543.717-4.505 4.505.717 21.095 3.481 4.608.717-.82 4.506L832 739.533zm-428.032-9.728V582.45h74.854V423.22h-30.617v129.127h-44.237V413.798H373.35v138.548h-43.52V423.219h-30.617v159.232h74.137v147.354h-43.52V602.624h-30.617V759.91H478.72V602.624h-30.618v127.18h-44.134zM148.89 582.45l-21.607 21.197-3.174 3.174-3.175-3.174L105.78 588.8l-3.379-3.277 3.38-3.277 43.11-42.393V364.237h-37.684V334.13h37.684V254.26h30.617v79.872h44.135v30.106h-44.135v145.715l25.6-25.088 3.175-3.174 3.174 3.174 15.155 14.746 3.38 3.276-3.38 3.277-47.104 46.285v65.024c0 33.178-5.12 65.024-13.824 94.413-5.325 18.022-10.547 31.13-14.745 39.629l-4.71 9.42-2.049 3.994-4.096-1.946-19.251-9.113-4.198-2.048 2.048-4.199 4.608-9.42c.716-1.332 2.252-4.813 3.993-9.319 2.97-7.475 5.94-15.974 8.704-25.497 7.885-26.932 12.698-56.013 12.698-86.016V582.45zm97.792 180.122l.921-4.506 2.15-10.24c12.8-61.645 17.511-195.584 16.999-358.605h220.672v-134.86H234.496l.102 4.71.205 10.65c.205 10.24.615 32.768.82 59.904.409 44.748.511 91.033.102 136.601-1.229 129.536-6.144 227.84-16.077 275.559l-2.15 10.24-.922 4.505 4.506.922 20.992 4.198 4.608.922zm19.865-403.456l-1.024-74.65h191.181v74.65H266.547zm634.266 31.437l3.072-3.277 14.54-15.36 3.175-3.38-3.482-3.174-121.344-109.875-3.072-1.229h-126.77l-3.073 1.229-121.241 109.875-3.482 3.175 3.174 3.379 14.541 15.36 3.072 3.277 3.38-2.97 115.2-103.014h103.833l115.2 103.014 3.277 2.97z"></path></svg></a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"[译] 如何基于 D3.js 使用外部数据源创建图表","date":"2020-09-27T08:18:39.741Z","slug":"d3-charts","author":{"name":"Alfxjx","picture":"/assets/blog/authors/alfxjx.jpeg"},"content":"\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e原文地址：\u003ca href=\"https://blog.bitsrc.io/how-to-create-charts-from-external-data-sources-with-d3-js-4abbcb574706\"\u003eHow to Create Charts from External Data Sources with D3.js\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e原文作者：\u003ca href=\"https://medium.com/@ds_mik\"\u003eShaumik Daityari\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译文出自：\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e本文永久链接：\u003ca href=\"https://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md\"\u003ehttps://github.com/xitu/gold-miner/blob/master/article/2020/how-to-create-charts-from-external-data-sources-with-d3-js.md\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e译者：\u003ca href=\"https://github.com/Alfxjx\"\u003eAlfxjx\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e校对者：\u003ca href=\"https://github.com/qq1037305420\"\u003eqq1037305420\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/12032/1*_2y7jPirLNtPHduWzlgphQ.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e福布斯于 2018 年年中的统计显示，人类\u003ca href=\"https://www.forbes.com/sites/bernardmarr/2018/05/21/how-much-data-do-we-create-every-day-the-mind-blowing-stats-everyone-should-read/\"\u003e每天约产生 2.5EB\u003c/a\u003e 的数据。随着对如此海量数据的机器学习算法的研究，强大的可视化技术有助于将所见以一个正确的方式呈现出来。数据可视化还可以帮助读者更快地处理数据并记住数据的关键特征。在过去的十年中，对可视化专家的需求也在增加。\u003c/p\u003e\n\u003cp\u003eD3 是一个运行于 web 端的 Javascript 可视化库。D3 的第一个版本发布于 2011 年，并且随着社区支持的增加而成熟。对于早期版本的 D3，学习曲线有些陡峭，但对于 JavaScript 初学者来说，最新版本学习起来更容易。大多数为 Web 构建的可视化都依赖于动态数据源 —— 因此，本文的目的是使您能够在 D3 中使用外部数据源创建图表。\u003c/p\u003e\n\u003ch2\u003eD3 中的柱状图\u003c/h2\u003e\n\u003cp\u003e在 D3 中加载外部数据之前，让我们创建一个基本的柱状图，并在加载外部数据后，重新绘制该柱状图。首先，通过下面的一行代码来加载 D3 脚本。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-html\"\u003e\u0026#x3C;script src=\"https://d3js.org/d3.v5.min.js\"\u003e\u0026#x3C;/script\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e你可能会发现，网络上的绝大部分的 D3 教程都是基于 v3 或者是 v4 版本的。但是本文中我们会使用在 2018 年的早期发布的 v5 版本的 D3 库。\u003ca href=\"https://github.com/d3/d3/releases/tag/v5.12.0\"\u003e最新版本的 D3 库\u003c/a\u003e大概是一个月前发布的（译注：最新版本的 D3 发布于 2019 年的 9 月）。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/d3/d3/blob/master/CHANGES.md#selections-d3-selection\"\u003eD3.js 的 changelog\u003c/a\u003e 记录了版本之间的改动。就本文而言，需要注意 v4 与 v5 的加载方式不同。\u003c/p\u003e\n\u003cp\u003e首先让我们定义标题和数据。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003evar title = \"Comments on Posts\",\n\tdata = [\n\t\t{ type: \"Post A\", amount: 4 },\n\t\t{ type: \"Post B\", amount: 2 },\n\t\t{ type: \"Post C\", amount: 7 },\n\t\t{ type: \"Post D\", amount: 5 },\n\t\t{ type: \"Post E\", amount: 6 },\n\t];\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在引入 D3 的脚本库之后，你可以使用全局变量 \u003ccode\u003ed3\u003c/code\u003e 来进行任意的有关 D3 库的操作。接着，通过将一个标题元素追加到 \u003ccode\u003ebody\u003c/code\u003e 标签中，从而给图标添加了一个标题。如果你是在某一个确定的 \u003ccode\u003ediv\u003c/code\u003e 标签之中创建图表的话，可在创建标题的元素之前选中该元素。另外，如果你知道标题将会保持不变，那么应该不使用 D3 而是在页面加载的时候就将其添加进来。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.select(\"body\").append(\"h3\").text(title);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在继续操作之前，先添加一些自定义 CSS。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-css\"\u003ebody {\n\tbackground-color: #3c3c3c;\n\tcolor: #cfcfcf;\n}\n\ndiv {\n\tline-height: 15px;\n\tmargin-bottom: 3px;\n\tbackground-color: grey;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e此时，页面上出现了标题。你可以在样式表中为此标题定义自定义样式。接下来，在保持宽度一定的情况下，根据数据的大小设置水平柱状图的长度，创建水平柱状图。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.select(\"body\")\n\t.selectAll(\"div\")\n\t.data(data)\n\t.enter()\n\t.append(\"div\")\n\t.style(\"width\", function (d) {\n\t\treturn d.amount * 40 + \"px\";\n\t})\n\t.style(\"height\", \"15px\");\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e这样一来你的简单柱状图就设置完成了。你可以在 \u003ca href=\"https://codepen.io/shaumik/pen/RwwNLQb\"\u003eCodePen\u003c/a\u003e 上查看它。若是需要再向柱状条添加标签，可以遍历数据源从而给与之对应柱状条的 \u003ccode\u003ediv\u003c/code\u003e 元素再添加一个文本元素。\u003c/p\u003e\n\u003cp\u003e现在让我们尝试使用外部文件源。\u003c/p\u003e\n\u003ch2\u003e从外部数据源加载数据\u003c/h2\u003e\n\u003cp\u003e如果数据与网页大小（平均约 2 MB），相比足够大，那么如果您声明此数据为内联，可能会通过增加加载时间而带来不便。因此，将其保存在文件中是一个好习惯。CSV（逗号分隔值）文件中的数据结构如下所示。\u003c/p\u003e\n\u003cp\u003e我们用于创建柱状图的外部数据已经\u003ca href=\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\"\u003e上传到 Github\u003c/a\u003e，CSV（逗号分隔值）文件以逗号分隔保存的数据。文件的内容如下所示：\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003etype,amount\nPost A,4\nPost B,2\nPost C,7\nPost D,5\nPost E,6\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在 D3 中读取 CSV 文件，可以使用 \u003ccode\u003ecsv()\u003c/code\u003e 方法。除此之外我们还使用了 \u003ccode\u003ed3.autoType\u003c/code\u003e 解析函数来将文件中的行数据转换成了 JavaScript 的对象。\u003ca href=\"https://github.com/d3/d3-dsv/blob/master/README.md#autoType\"\u003e这个文档\u003c/a\u003e列举了诸如将空值转换成 \u003ccode\u003enull\u003c/code\u003e 等之类的转换规则。你可以在加载完成之后的 \u003ccode\u003ethen()\u003c/code\u003e 方法中用控制台打印的方式来观察转换之后的对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.csv(\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\n\td3.autoType\n).then(function (data) {\n\tconsole.log(data);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下面展示的是在 Chrome 开发者工具的控制台中显示的转换之后的 Javascript 对象。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e(5) [{…}, {…}, {…}, {…}, {…}, columns: Array(2)]\n0: {type: \"Post A\", amount: 4}\n1: {type: \"Post B\", amount: 2}\n2: {type: \"Post C\", amount: 7}\n3:\n  amount: 5\n  type: \"Post D\"\n  __proto__: Object\n4: {type: \"Post E\", amount: 6}\ncolumns: Array(2)\n  0: \"type\"\n  1: \"amount\"\n  length: 2\n  __proto__: Array(0)\n  length: 5\n__proto__: Array(0)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e存在类似的功能来加载其他类型的外部文件。要加载文本文件，请使用以下代码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.text(\"/path/to/file.txt\").then(function (text) {\n\t// do something\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果您的文件由其他分隔符分隔，则可以使用 \u003ccode\u003edsv()\u003c/code\u003e 函数。唯一的区别是第一个参数，用于表明文件的分隔符。您也可以使用 \u003ccode\u003edsv()\u003c/code\u003e 函数并使用逗号作为分隔符参数来加载 CSV 文件。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.dsv(\n\t\",\",\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\n\td3.autoType\n).then(function (data) {\n\tconsole.log(data);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e另外，以下的几个方法也是可选择的：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ejson()\u003c/code\u003e: to load a file containing data in JSON format\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003exml()\u003c/code\u003e: to load a file containing XML data\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eimage()\u003c/code\u003e: to load an image\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esvg()\u003c/code\u003e: to load vector graphics\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e使用外部数据源创建图表\u003c/h2\u003e\n\u003cp\u003e现在您已经成功地从外部源加载了数据，让我们创建图表。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003ed3.csv(\n\t\"https://raw.githubusercontent.com/sdaityari/my_git_project/master/posts.csv\",\n\td3.autoType\n).then(function (data) {\n\td3.select(\"body\")\n\t\t.selectAll(\"div\")\n\t\t.data(data)\n\t\t.enter()\n\t\t.append(\"div\")\n\t\t.style(\"width\", function (d) {\n\t\t\treturn d.amount * 40 + \"px\";\n\t\t})\n\t\t.style(\"height\", \"15px\");\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e与前一个函数的唯一区别在于，需要在 \u003ccode\u003ecsv()\u003c/code\u003e 函数中进行 \u003ccode\u003edata()\u003c/code\u003e 调用。由于列名相同，因此其余代码保持不变。\u003c/p\u003e\n\u003cp\u003e利用外部数据绘制的相同柱状图可以在 \u003ca href=\"https://codepen.io/shaumik/pen/mGWRzm\"\u003eCodePen\u003c/a\u003e 查看。\u003c/p\u003e\n\u003ch2\u003e实时数据\u003c/h2\u003e\n\u003cp\u003eD3 的一个优点是可以通过在触发事件后更改包含图表的元素来实时更新图表。 更新图表的流程如下：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e捕获到事件的触发，并调用函数；\u003c/li\u003e\n\u003cli\u003e覆盖或更新现有数据；\u003c/li\u003e\n\u003cli\u003e刷新包含图表的可视元素；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e这里是使用 Python 和 Websockets 描述的整个过程的\u003ca href=\"https://medium.com/@benjaminmbrown/real-time-data-visualization-with-d3-crossfilter-and-websockets-in-python-tutorial-dba5255e7f0e\"\u003e示例\u003c/a\u003e。\u003c/p\u003e\n\u003ch2\u003e最后的思考\u003c/h2\u003e\n\u003cp\u003e这样，我们就完成了使用 D3 从外部数据源创建图表的教程。我们首先使用 D3 创建了一个简单的柱状图，探索了从外部数据源读取数据的各种方法，最后，使用新加载的数据创建了一个图表。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如果发现译文存在错误或其他需要改进的地方，欢迎到 \u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 \u003cstrong\u003e本文永久链接\u003c/strong\u003e 即为本文在 GitHub 上的 MarkDown 链接。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003chr\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e 是一个翻译优质互联网技术文章的社区，文章来源为 \u003ca href=\"https://juejin.im\"\u003e掘金\u003c/a\u003e 上的英文分享文章。内容覆盖 \u003ca href=\"https://github.com/xitu/gold-miner#android\"\u003eAndroid\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#ios\"\u003eiOS\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF\"\u003e前端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF\"\u003e后端\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE\"\u003e区块链\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81\"\u003e产品\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1\"\u003e设计\u003c/a\u003e、\u003ca href=\"https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD\"\u003e人工智能\u003c/a\u003e等领域，想要查看更多优质译文请持续关注 \u003ca href=\"https://github.com/xitu/gold-miner\"\u003e掘金翻译计划\u003c/a\u003e、\u003ca href=\"http://weibo.com/juejinfanyi\"\u003e官方微博\u003c/a\u003e、\u003ca href=\"https://zhuanlan.zhihu.com/juejinfanyi\"\u003e知乎专栏\u003c/a\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n","coverImage":"/assets/blog/d3.png"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"d3-charts"},"buildId":"zlhWgocm1rjUbN_It-MYj","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>